{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 21, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/env.mjs"],"sourcesContent":["import { createEnv } from \"@t3-oss/env-nextjs\";\nimport { z } from \"zod\";\n\n/**\n * ç’°å¢ƒè®Šæ•¸é…ç½® - ç¨‹å¼ç¢¼å„ªå…ˆçš„é…ç½®ç®¡ç†\n *\n * è¨­è¨ˆåŸå‰‡ï¼š\n * 1. env.mjs åŒ…å«æ‰€æœ‰é è¨­å€¼å’Œæ¥­å‹™é‚è¼¯é…ç½®\n * 2. .env æª”æ¡ˆåªè¦†å¯«éœ€è¦è®Šæ›´æˆ–æ•æ„Ÿçš„è¨­å®š\n * 3. é–‹ç™¼æ™‚ä¾è³´é è¨­å€¼ï¼Œç”Ÿç”¢æ™‚ç”¨ç’°å¢ƒè®Šæ•¸è¦†è“‹\n * 4. å…±äº«é…ç½®é¿å…é‡è¤‡å®šç¾©\n *\n * ä¸»è¦ä¿®æ­£ï¼š\n * 1. ä½¿ç”¨ z.coerce ç°¡åŒ–é¡å‹è½‰æ›ï¼Œä¾‹å¦‚ z.coerce.boolean() æœƒè‡ªå‹•å°‡ \"true\" è½‰ç‚º trueã€‚\n * 2. ç§»é™¤å‹•æ…‹ç”Ÿæˆ client config çš„å‡½å¼ï¼Œç›´æ¥åœ¨ client schema ä¸­å®šç¾© NEXT_PUBLIC_ è®Šæ•¸ã€‚\n * 3. runtimeEnv ç›´æ¥è¨­ç‚º process.envï¼Œé€™æ˜¯ Next.js ç’°å¢ƒä¸‹çš„æ¨™æº–åšæ³•ã€‚\n */\n\nexport const env = createEnv({\n    /**\n     * ä¼ºæœå™¨ç«¯å°ˆç”¨ç’°å¢ƒè®Šæ•¸ã€‚\n     * é€™äº›è®Šæ•¸ã€Œä¸æœƒã€æš´éœ²çµ¦å®¢æˆ¶ç«¯ï¼Œé©åˆæ”¾ç½®æ•æ„Ÿè³‡è¨Šå¦‚ API é‡‘é‘°ã€‚\n     */\n    server: {\n        // ==========================================\n        // å°ˆæ¡ˆæ ¸å¿ƒé…ç½® - ä¼ºæœå™¨ç«¯å°ˆç”¨\n        // ==========================================\n        PROJECT_CODE: z.string().default(\"minmax2025\"),\n        COUNTRY_SUBDOMAIN_MAP: z.string().default('{}'),\n\n        // ==========================================\n        // API èˆ‡å¤–éƒ¨æœå‹™é…ç½® - ä¼ºæœå™¨ç«¯å°ˆç”¨\n        // ==========================================\n        API_BASE_URL: z.string().url().default(\"https://v5.jeffy.test\"),\n        I18N_CACHE_STRATEGY: z.enum([\"memory\", \"redis\", \"none\"]).default(\"memory\"),\n\n    },\n\n    /**\n     * å®¢æˆ¶ç«¯ç’°å¢ƒè®Šæ•¸ã€‚\n     * å¿…é ˆä»¥ `NEXT_PUBLIC_` é–‹é ­ï¼Œé€™äº›è®Šæ•¸æœƒè¢«æ‰“åŒ…é€²å®¢æˆ¶ç«¯çš„ JavaScript bundle ä¸­ã€‚\n     * çµ•å°ä¸è¦åœ¨æ­¤è™•æ”¾ç½®ä»»ä½•æ•æ„Ÿè³‡è¨Šã€‚\n     */\n    client: {\n        // ==========================================\n        // ğŸ—ï¸ å°ˆæ¡ˆåŸºæœ¬è³‡è¨Š (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_PROJECT_NAME: z.string().default(\"æ¸¬è©¦ç¶²ç«™\"),\n        NEXT_PUBLIC_API_VERSION: z.string().default(\"1.0.0\"),\n\n        // ==========================================\n        // ğŸŒ åœ‹éš›åŒ–èˆ‡èªç³»é…ç½® (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_DEFAULT_LOCALE: z.string().default(\"zh-TW\"),\n        NEXT_PUBLIC_SUPPORTED_LOCALES: z.string().default('zh-TW'),\n        NEXT_PUBLIC_LOCALE_PREFIX_MODE: z.enum(['always', 'as-needed', 'never']).default('as-needed'),\n        NEXT_PUBLIC_LOCALE_DETECTION_ENABLED: z.coerce.boolean().default(true),\n        NEXT_PUBLIC_MULTI_LANGUAGE_ENABLED: z.coerce.boolean().default(true),\n        NEXT_PUBLIC_INTERNATIONALIZATION_ENABLED: z.coerce.boolean().default(true),\n\n        // ==========================================\n        // ğŸ—ºï¸ åœ°ç†ä½ç½®åµæ¸¬é…ç½® (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_GEO_DETECTION_STRATEGY: z.enum([\"cdn-only\", \"api-only\", \"cdn-fallback\"]).default(\"api-only\"),\n        NEXT_PUBLIC_GEO_DETECTION_ENABLED: z.coerce.boolean().default(false),\n        NEXT_PUBLIC_GEO_REDIRECT_MODE: z.enum([\"off\", \"suggest\", \"force\"]).default(\"suggest\"),\n        NEXT_PUBLIC_FORCE_REDIRECT: z.coerce.boolean().default(false),\n        NEXT_PUBLIC_CDN_COUNTRY_HEADER: z.string().default(\"cf-ipcountry\"),\n        NEXT_PUBLIC_GEO_API_PROVIDER: z.enum([\"ipapi\", \"ipinfo\", \"geoplugin\"]).default(\"geoplugin\"),\n        NEXT_PUBLIC_GEO_API_TIMEOUT: z.coerce.number().default(5000),\n\n        // ==========================================\n        // ğŸ”„ å¿«å–ç³»çµ±é…ç½® (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_CACHE_ENABLED: z.coerce.boolean().default(true),\n        NEXT_PUBLIC_CACHE_CDN_ENABLED: z.coerce.boolean().default(false),\n        NEXT_PUBLIC_CACHE_DEFAULT_TTL: z.coerce.number().default(3600),\n\n        // ==========================================\n        // âš™ï¸ åŠŸèƒ½é–‹é—œ (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_DEV_MODE_ENABLED: z.coerce.boolean().default(false),\n        NEXT_PUBLIC_MEMBERSHIP_ENABLED: z.coerce.boolean().default(false),\n\n        // ==========================================\n        // ğŸ”§ é–‹ç™¼èˆ‡æ¸¬è©¦é…ç½® (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_USE_MOCK_API: z.coerce.boolean().default(true),\n        NEXT_PUBLIC_MOCK_API_DELAY: z.coerce.number().default(100),\n        NEXT_PUBLIC_MOCK_ERROR_ENABLED: z.coerce.boolean().default(false),\n        NEXT_PUBLIC_MOCK_ERROR_RATE: z.coerce.number().min(0).max(1).default(0.0),\n\n        // ==========================================\n        // ğŸ“Š ç›£æ§èˆ‡æ—¥èªŒé…ç½® (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_API_LOGGING_ENABLED: z.coerce.boolean().default(false),\n        NEXT_PUBLIC_PERFORMANCE_MONITORING_ENABLED: z.coerce.boolean().default(false),\n\n        // ==========================================\n        // â±ï¸ è¶…æ™‚è¨­å®š (ä¾†è‡ªå…±äº«é…ç½®)\n        // ==========================================\n        NEXT_PUBLIC_API_TIMEOUT: z.coerce.number().default(30000),\n        NEXT_PUBLIC_CONTENT_API_TIMEOUT: z.coerce.number().default(60000),\n\n        // ==========================================\n        // ğŸŒ API èˆ‡æœå‹™é…ç½® - å®¢æˆ¶ç«¯å°ˆç”¨\n        // ==========================================\n        NEXT_PUBLIC_API_BASE_URL: z.string().url().default(\"http://localhost:3000/api/ssr/\"),\n\n        // ==========================================\n        // ğŸ”§ å¤–éƒ¨æœå‹™é…ç½® - å®¢æˆ¶ç«¯å°ˆç”¨\n        // ==========================================\n        NEXT_PUBLIC_SENTRY_DSN: z.string().url().optional(),\n    },\n\n    /**\n     * é‹è¡Œæ™‚çš„ç’°å¢ƒè®Šæ•¸ä¾†æºã€‚\n     * å°æ–¼ Next.jsï¼Œé€™æ‡‰è©²ç¸½æ˜¯ `process.env`ã€‚\n     * createEnv æœƒè‡ªå‹•è™•ç† server-side å’Œ client-side çš„è®Šæ•¸åˆ†é›¢ã€‚\n     */\n    runtimeEnv: process.env,\n\n    /**\n     * å¦‚æœä½ æƒ³åœ¨å»ºç½®ï¼ˆbuildï¼‰éšæ®µï¼Œç•¶ç¼ºå°‘å®¢æˆ¶ç«¯ç’°å¢ƒè®Šæ•¸æ™‚å°±è®“å»ºç½®å¤±æ•—ï¼Œ\n     * å¯ä»¥å–æ¶ˆä¸‹é¢é€™è¡Œçš„è¨»è§£ã€‚\n     */\n    // skipValidation: !!process.env.CI,\n});"],"names":[],"mappings":"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"}},
    {"offset": {"line": 140, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/api.config.ts"],"sourcesContent":["import { env } from '@/env.mjs';\n\n/**\n * API æ‡‰ç”¨é…ç½®ï¼ˆåªä¿ç•™æ¥­å‹™é‚è¼¯ï¼‰\n * - ä¸é¡å°„ env å€¼ï¼›éœ€è¦æ™‚æ–¼æ­¤é›†ä¸­è™•ç†æ¢ä»¶/è½‰æ›/ç¾¤çµ„\n * - å‘½åä½¿ç”¨å°å¯«ï¼ˆcamelCaseï¼‰\n */\n\n\n\n\nexport const apiConfig = {\n    // è¡ç”Ÿï¼šæ ¹æ“šæ˜¯å¦ä½¿ç”¨ Mock é¸æ“‡å¯¦éš› baseUrl\n    baseUrl: env.NEXT_PUBLIC_USE_MOCK_API ? env.NEXT_PUBLIC_API_BASE_URL : env.API_BASE_URL,\n\n    // è¡ç”Ÿï¼šæ ¹æ“šæ˜¯å¦ä½¿ç”¨ Mock åˆ‡æ›ç«¯é»è·¯å¾‘\n    endpoints: env.NEXT_PUBLIC_USE_MOCK_API\n        ? {\n            language: 'languages',\n            locales: 'locales',\n            systemMenus: 'system-menus',\n            webData: 'web-data',\n            detail: 'detail',\n        }\n        : {\n            language: '/api/v1/languages',\n            locales: '/api/v1/locales',\n            systemMenus: '/api/v1/system-menus',\n            webData: '/api/v1/web-data',\n            detail: '/api/v1/detail',\n        },\n\n    // ç¾¤çµ„ï¼šè¶…æ™‚ï¼ˆæ¯«ç§’ï¼‰ç›´æ¥å– envï¼Œé›†ä¸­ä½¿ç”¨\n    timeouts: {\n        api: env.NEXT_PUBLIC_API_TIMEOUT,\n        content: env.NEXT_PUBLIC_CONTENT_API_TIMEOUT,\n        geo: env.NEXT_PUBLIC_GEO_API_TIMEOUT,\n    },\n\n    // æ¥­å‹™å¸¸æ•¸ï¼šé‡è©¦ç­–ç•¥ï¼ˆå¦‚éœ€ç’°å¢ƒåŒ–ï¼Œæ–¼æ­¤è™•åŠ è¡ç”Ÿé‚è¼¯ï¼‰\n    retry: {\n        attempts: 3,\n        delay: 1000,\n        exponentialBackoff: true,\n    },\n\n    // æ¥­å‹™åˆ¤æ–·ï¼šæ˜¯å¦æ¨¡æ“¬å»¶é²/éŒ¯èª¤èˆ‡ç›¸é—œåƒæ•¸\n    shouldSimulateDelay: () => env.NEXT_PUBLIC_USE_MOCK_API && env.NEXT_PUBLIC_MOCK_API_DELAY > 0,\n    getMockDelay: () => env.NEXT_PUBLIC_MOCK_API_DELAY,\n    shouldSimulateError: () => env.NEXT_PUBLIC_MOCK_ERROR_ENABLED && Math.random() < env.NEXT_PUBLIC_MOCK_ERROR_RATE,\n} as const;\n\nexport type ApiConfig = typeof apiConfig;"],"names":[],"mappings":";;;AAAA;;AAWO,MAAM,YAAY;IACrB,8BAA8B;IAC9B,SAAS,mHAAA,CAAA,MAAG,CAAC,wBAAwB,GAAG,mHAAA,CAAA,MAAG,CAAC,wBAAwB,GAAG,mHAAA,CAAA,MAAG,CAAC,YAAY;IAEvF,wBAAwB;IACxB,WAAW,mHAAA,CAAA,MAAG,CAAC,wBAAwB,GACjC;QACE,UAAU;QACV,SAAS;QACT,aAAa;QACb,SAAS;QACT,QAAQ;IACZ,IACE;QACE,UAAU;QACV,SAAS;QACT,aAAa;QACb,SAAS;QACT,QAAQ;IACZ;IAEJ,wBAAwB;IACxB,UAAU;QACN,KAAK,mHAAA,CAAA,MAAG,CAAC,uBAAuB;QAChC,SAAS,mHAAA,CAAA,MAAG,CAAC,+BAA+B;QAC5C,KAAK,mHAAA,CAAA,MAAG,CAAC,2BAA2B;IACxC;IAEA,4BAA4B;IAC5B,OAAO;QACH,UAAU;QACV,OAAO;QACP,oBAAoB;IACxB;IAEA,sBAAsB;IACtB,qBAAqB,IAAM,mHAAA,CAAA,MAAG,CAAC,wBAAwB,IAAI,mHAAA,CAAA,MAAG,CAAC,0BAA0B,GAAG;IAC5F,cAAc,IAAM,mHAAA,CAAA,MAAG,CAAC,0BAA0B;IAClD,qBAAqB,IAAM,mHAAA,CAAA,MAAG,CAAC,8BAA8B,IAAI,KAAK,MAAM,KAAK,mHAAA,CAAA,MAAG,CAAC,2BAA2B;AACpH"}},
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/app.client.config.ts"],"sourcesContent":["import { env } from '@/env.mjs';\n\n/**\n * å®¢æˆ¶ç«¯æ‡‰ç”¨é…ç½®ï¼ˆåƒ…ä¿ç•™å¿…è¦çš„æ¥­å‹™è¡ç”Ÿå€¼ï¼‰\n * - ç›´æ¥åœ¨ä½¿ç”¨è™•è®€ env.NEXT_PUBLIC_*ï¼Œæ­¤è™•ä¸é‡è¤‡åŒ…è£\n * - å‘½åä½¿ç”¨å°å¯«ï¼ˆcamelCaseï¼‰\n */\nexport const appConfig = {\n    // è¡ç”Ÿï¼šAPI è¶…æ™‚ï¼ˆæ¯«ç§’ï¼‰ï¼Œè‹¥ç„¡è¨­å®šå‰‡å›é€€ 30000\n    apiTimeout:\n        typeof env.NEXT_PUBLIC_API_TIMEOUT === 'number'\n            ? env.NEXT_PUBLIC_API_TIMEOUT\n            : Number.parseInt(String(env.NEXT_PUBLIC_API_TIMEOUT ?? ''), 10) || 30000,\n\n    // è¡ç”Ÿï¼ši18n å•Ÿç”¨ï¼ˆå®¢æˆ¶ç«¯è¦–è§’ï¼‰çš„å¸ƒæ—æ­£è¦åŒ–\n    i18nEnabled:\n        typeof env.NEXT_PUBLIC_MULTI_LANGUAGE_ENABLED === 'boolean'\n            ? env.NEXT_PUBLIC_MULTI_LANGUAGE_ENABLED\n            : String(env.NEXT_PUBLIC_MULTI_LANGUAGE_ENABLED).toLowerCase() === 'true',\n} as const;\n\nexport type AppClientConfig = typeof appConfig;"],"names":[],"mappings":";;;AAAA;;AAOO,MAAM,YAAY;IACrB,8BAA8B;IAC9B,YACI,OAAO,mHAAA,CAAA,MAAG,CAAC,uBAAuB,KAAK,WACjC,mHAAA,CAAA,MAAG,CAAC,uBAAuB,GAC3B,OAAO,QAAQ,CAAC,OAAO,mHAAA,CAAA,MAAG,CAAC,uBAAuB,IAAI,KAAK,OAAO;IAE5E,0BAA0B;IAC1B,aACI,OAAO,mHAAA,CAAA,MAAG,CAAC,kCAAkC,KAAK,YAC5C,mHAAA,CAAA,MAAG,CAAC,kCAAkC,GACtC,OAAO,mHAAA,CAAA,MAAG,CAAC,kCAAkC,EAAE,WAAW,OAAO;AAC/E"}},
    {"offset": {"line": 198, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/app.server.config.ts"],"sourcesContent":["import { env } from '@/env.mjs';\n\n/**\n * æœå‹™ç«¯æ‡‰ç”¨é…ç½®å±¤\n * åªåŒ…å«çœŸæ­£éœ€è¦æ¥­å‹™é‚è¼¯è™•ç†çš„é…ç½®\n * âš ï¸ æ­¤æª”æ¡ˆåªèƒ½åœ¨ä¼ºæœå™¨ç«¯ä½¿ç”¨\n */\nexport const SERVER_APP_CONFIG = {\n    // åœ‹éš›åŒ–é…ç½® - æ•¸æ“šè½‰æ›\n    i18n: {\n        supportedLocales: env.SUPPORTED_LOCALES.split(',').map((locale) => locale.trim()),\n        countrySubdomainMap: JSON.parse(env.COUNTRY_SUBDOMAIN_MAP || '{}'),\n    },\n\n    // API é…ç½® - æ¢ä»¶é‚è¼¯\n    api: {\n        baseUrl: env.USE_MOCK_API ? env.API_BASE_URL : env.API_BASE_URL,\n    },\n} as const;\n\n// å°å‡ºè¨ˆç®—å±¬æ€§ - åªåŒ…å«çœŸæ­£çš„æ¥­å‹™é‚è¼¯çµ„åˆ\nexport const SERVER_COMPUTED = {\n    /** æ˜¯å¦å•Ÿç”¨å®Œæ•´åœ‹éš›åŒ–åŠŸèƒ½ï¼ˆä¼ºæœç«¯è¦–è§’ï¼‰ */\n    isI18nEnabled: () => env.INTERNATIONALIZATION_ENABLED && env.MULTI_LANGUAGE_ENABLED,\n\n    /** æª¢æŸ¥æ˜¯å¦æ”¯æ´ç‰¹å®šèªç³» */\n    isLocaleSupported: (locale: string) => SERVER_APP_CONFIG.i18n.supportedLocales.includes(locale),\n\n    /** æ˜¯å¦æ‡‰è©²æ¨¡æ“¬ API å»¶é² */\n    shouldSimulateDelay: () => env.USE_MOCK_API && env.MOCK_API_DELAY > 0,\n\n    /** æ˜¯å¦æ‡‰è©²æ¨¡æ“¬éŒ¯èª¤ */\n    shouldSimulateError: () => env.MOCK_ERROR_ENABLED && Math.random() < env.MOCK_ERROR_RATE,\n} as const;\n\nexport type ServerAppConfig = typeof SERVER_APP_CONFIG;"],"names":[],"mappings":";;;;AAAA;;AAOO,MAAM,oBAAoB;IAC7B,eAAe;IACf,MAAM;QACF,kBAAkB,mHAAA,CAAA,MAAG,CAAC,iBAAiB,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,SAAW,OAAO,IAAI;QAC9E,qBAAqB,KAAK,KAAK,CAAC,mHAAA,CAAA,MAAG,CAAC,qBAAqB,IAAI;IACjE;IAEA,gBAAgB;IAChB,KAAK;QACD,SAAS,mHAAA,CAAA,MAAG,CAAC,YAAY,GAAG,mHAAA,CAAA,MAAG,CAAC,YAAY,GAAG,mHAAA,CAAA,MAAG,CAAC,YAAY;IACnE;AACJ;AAGO,MAAM,kBAAkB;IAC3B,uBAAuB,GACvB,eAAe,IAAM,mHAAA,CAAA,MAAG,CAAC,4BAA4B,IAAI,mHAAA,CAAA,MAAG,CAAC,sBAAsB;IAEnF,eAAe,GACf,mBAAmB,CAAC,SAAmB,kBAAkB,IAAI,CAAC,gBAAgB,CAAC,QAAQ,CAAC;IAExF,kBAAkB,GAClB,qBAAqB,IAAM,mHAAA,CAAA,MAAG,CAAC,YAAY,IAAI,mHAAA,CAAA,MAAG,CAAC,cAAc,GAAG;IAEpE,aAAa,GACb,qBAAqB,IAAM,mHAAA,CAAA,MAAG,CAAC,kBAAkB,IAAI,KAAK,MAAM,KAAK,mHAAA,CAAA,MAAG,CAAC,eAAe;AAC5F"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/locale.server.config.ts"],"sourcesContent":["import { env } from '@/env.mjs';\n\n/**\n * æœå‹™ç«¯èªç³»é…ç½®ï¼ˆåªä¿ç•™éœ€è¦çš„è½‰æ›èˆ‡å·¥å…·ï¼‰\n * - ä¸é¡å°„ env å€¼ï¼ˆå¦‚ defaultLocale/localePrefixModeï¼‰ï¼Œåœ¨ä½¿ç”¨è™•ç›´æ¥è®€ env\n * - å‘½åä½¿ç”¨å°å¯«ï¼ˆcamelCaseï¼‰\n */\n\nexport const serverLocaleConfig = {\n    // è¡ç”Ÿï¼šæ”¯æ´èªç³»é™£åˆ—\n    supportedLocales: env.SUPPORTED_LOCALES.split(',').map((l) => l.trim()),\n    // å·¥å…·ï¼šèªç³»é©—è­‰ï¼ˆä½¿ç”¨è¡ç”Ÿ supportedLocalesï¼‰\n    isValidLocale: (locale: string): boolean => {\n        return serverLocaleConfig.supportedLocales.includes(locale);\n    },\n    // å·¥å…·ï¼šå–å¾—æœ‰æ•ˆçš„é è¨­èªç³»\n    getValidDefaultLocale: (): string => {\n        const envDefault = env.DEFAULT_LANGUAGE;\n        return serverLocaleConfig.supportedLocales.includes(envDefault)\n            ? envDefault\n            : serverLocaleConfig.supportedLocales[0];\n    },\n    // è¡ç”Ÿï¼šåœ‹å®¶å­ç¶²åŸŸæ˜ å°„\n    countrySubdomainMap: JSON.parse(env.COUNTRY_SUBDOMAIN_MAP || '{}'),\n    // å·¥å…·ï¼šä¾åœ‹å®¶å–å­ç¶²åŸŸï¼ˆä½¿ç”¨è¡ç”Ÿ countrySubdomainMapï¼‰\n    getSubdomainByCountry: (country: string): string | null => {\n        return serverLocaleConfig.countrySubdomainMap[country] || null;\n    },\n} as const;\n\nexport type ServerLocaleConfig = typeof serverLocaleConfig;"],"names":[],"mappings":";;;AAAA;;AAQO,MAAM,qBAAqB;IAC9B,YAAY;IACZ,kBAAkB,mHAAA,CAAA,MAAG,CAAC,iBAAiB,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI;IACpE,iCAAiC;IACjC,eAAe,CAAC;QACZ,OAAO,mBAAmB,gBAAgB,CAAC,QAAQ,CAAC;IACxD;IACA,eAAe;IACf,uBAAuB;QACnB,MAAM,aAAa,mHAAA,CAAA,MAAG,CAAC,gBAAgB;QACvC,OAAO,mBAAmB,gBAAgB,CAAC,QAAQ,CAAC,cAC9C,aACA,mBAAmB,gBAAgB,CAAC,EAAE;IAChD;IACA,aAAa;IACb,qBAAqB,KAAK,KAAK,CAAC,mHAAA,CAAA,MAAG,CAAC,qBAAqB,IAAI;IAC7D,uCAAuC;IACvC,uBAAuB,CAAC;QACpB,OAAO,mBAAmB,mBAAmB,CAAC,QAAQ,IAAI;IAC9D;AACJ"}},
    {"offset": {"line": 253, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/locale.client.config.ts"],"sourcesContent":["import { env } from '@/env.mjs';\n\n/**\n * å®¢æˆ¶ç«¯èªç³»é…ç½®ï¼ˆåƒ…ä¿ç•™æ¥­å‹™é‚è¼¯ï¼‰\n * åŸå‰‡ï¼š\n * - ä¸é‡è¤‡ env.mjsï¼ŒåŸå§‹å€¼åœ¨ä½¿ç”¨è™•ç›´æ¥è®€ env.NEXT_PUBLIC_*\n * - åªåšå¿…è¦çš„è¡ç”Ÿ/å·¥å…·ï¼Œå‘½åç”¨å°å¯«ï¼ˆcamelCaseï¼‰\n */\nexport const clientLocaleConfig = {\n    // è¡ç”Ÿï¼šæ”¯æ´èªç³»é™£åˆ—\n    supportedLocales: env.NEXT_PUBLIC_SUPPORTED_LOCALES.split(',').map((l) => l.trim()),\n\n    // å·¥å…·ï¼šé©—è­‰èªç³»æ˜¯å¦è¢«æ”¯æ´ï¼ˆä½¿ç”¨è¡ç”Ÿ supportedLocalesï¼‰\n    isValidLocale: (locale: string): boolean => {\n        return clientLocaleConfig.supportedLocales.includes(locale);\n    },\n} as const;\n\nexport type ClientLocaleConfig = typeof clientLocaleConfig;\n"],"names":[],"mappings":";;;AAAA;;AAQO,MAAM,qBAAqB;IAC9B,YAAY;IACZ,kBAAkB,mHAAA,CAAA,MAAG,CAAC,6BAA6B,CAAC,KAAK,CAAC,KAAK,GAAG,CAAC,CAAC,IAAM,EAAE,IAAI;IAEhF,sCAAsC;IACtC,eAAe,CAAC;QACZ,OAAO,mBAAmB,gBAAgB,CAAC,QAAQ,CAAC;IACxD;AACJ"}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/cache.client.config.ts"],"sourcesContent":["/**\n * å¿«å–ç³»çµ±å®¢æˆ¶ç«¯é…ç½®æª”æ¡ˆï¼ˆåƒ…æ¥­å‹™é‚è¼¯ï¼‰\n */\n\n// redis ç›¸é—œéµæ ¼å¼ï¼ˆå®¢æˆ¶ç«¯åƒ…ä½œ key è¦å‰‡ä½¿ç”¨ï¼Œä¸é€£ç·šï¼‰\nconst redisConfig = {\n    prefix: 'minmax:',\n    keySeparator: ':',\n} as const;\n\n/**\n * å¿«å–è³‡æ–™é¡å‹å®šç¾© - çµ±ä¸€ç®¡ç†æ‰€æœ‰å¿«å–ç›¸é—œè¨­å®š\n * - åƒ…ä¿ç•™å®¢æˆ¶ç«¯éœ€è¦çš„é è¨­ ttl/tags/æè¿°\n */\nconst cacheDataTypes = {\n    languages: {\n        ttl: 7200, // 2 å°æ™‚\n        tags: ['languages', 'static-data'] as string[],\n        description: 'èªè¨€è³‡æ–™å¿«å–',\n    },\n    locales: {\n        ttl: 7200, // 2 å°æ™‚\n        tags: ['locales', 'static-data'] as string[],\n        description: 'åœ°å€è¨­å®šå¿«å–',\n    },\n    menus: {\n        ttl: 3600, // 1 å°æ™‚\n        tags: ['menus', 'navigation'] as string[],\n        description: 'é¸å–®è³‡æ–™å¿«å–',\n    },\n    webData: {\n        ttl: 3600, // 1 å°æ™‚\n        tags: ['web-data', 'static-data'] as string[],\n        description: 'ç¶²ç«™è³‡æ–™å¿«å–',\n    },\n    pages: {\n        ttl: 1800, // 30 åˆ†é˜\n        tags: ['pages', 'content'] as string[],\n        description: 'é é¢å…§å®¹å¿«å–',\n    },\n    geoData: {\n        ttl: 1800, // 30 åˆ†é˜\n        tags: ['geo-data', 'location'] as string[],\n        description: 'åœ°ç†ä½ç½®è³‡æ–™å¿«å–',\n    },\n    userData: {\n        ttl: 600, // 10 åˆ†é˜\n        tags: ['user-data', 'dynamic-data'] as string[],\n        description: 'ä½¿ç”¨è€…è³‡æ–™å¿«å–',\n    },\n    apiResponse: {\n        ttl: 3600, // é è¨­ 1 å°æ™‚ï¼Œæœå‹™ç«¯å¯è¦†è“‹\n        tags: ['api-response'] as string[],\n        description: 'API å›æ‡‰å¿«å–',\n    },\n} as const;\n\nexport type CacheDataType = keyof typeof cacheDataTypes;\n\n/**\n * å®¢æˆ¶ç«¯å¿«å–é…ç½®ï¼ˆåƒ…æ¥­å‹™é‚è¼¯ï¼‰\n */\nexport const cacheConfig = {\n    // åŸºç¤é…ç½®ï¼ˆå®¢æˆ¶ç«¯é è¨­å€¼ï¼‰\n    enabled: true,\n    cdnEnabled: false,\n    defaultTtl: 3600,\n    strategy: 'memory' as const,\n\n    // key è¦å‰‡ï¼ˆåƒ…ä½œç‚º key ç”Ÿæˆè¦ç¯„ï¼‰\n    redis: redisConfig,\n\n    // å¾ cacheDataTypes è‡ªå‹•ç”Ÿæˆ ttl èˆ‡ tags æ˜ å°„\n    ttl: {\n        languages: cacheDataTypes.languages.ttl,\n        locales: cacheDataTypes.locales.ttl,\n        menus: cacheDataTypes.menus.ttl,\n        webData: cacheDataTypes.webData.ttl,\n        pages: cacheDataTypes.pages.ttl,\n        geoData: cacheDataTypes.geoData.ttl,\n        userData: cacheDataTypes.userData.ttl,\n        apiResponse: cacheDataTypes.apiResponse.ttl,\n    },\n\n    tags: {\n        languages: cacheDataTypes.languages.tags,\n        locales: cacheDataTypes.locales.tags,\n        menus: cacheDataTypes.menus.tags,\n        webData: cacheDataTypes.webData.tags,\n        pages: cacheDataTypes.pages.tags,\n        geoData: cacheDataTypes.geoData.tags,\n        userData: cacheDataTypes.userData.tags,\n        apiResponse: cacheDataTypes.apiResponse.tags,\n    },\n\n    // å¿«å–éµå€¼ç”Ÿæˆï¼ˆä¸ä¾è³´è‡ªèº«ç‰©ä»¶ï¼Œé¿å…åˆå§‹åŒ–é †åºå•é¡Œï¼‰\n    generateKey: (type: CacheDataType, identifier: string, locale?: string): string => {\n        const parts = [redisConfig.prefix, type, identifier];\n        if (locale) parts.push(locale);\n        return parts.join(redisConfig.keySeparator);\n    },\n} as const;\n\n/**\n * å–å¾—æŒ‡å®šè³‡æ–™é¡å‹çš„å®Œæ•´é…ç½®\n */\nexport function getCacheConfig(type: CacheDataType) {\n    return cacheDataTypes[type];\n}\n\n/**\n * å–å¾—æŒ‡å®šè³‡æ–™é¡å‹çš„ TTLï¼ˆæ¯«ç§’ï¼‰\n */\nexport function getCacheTtl(type: CacheDataType): number {\n    return cacheDataTypes[type].ttl * 1000;\n}\n\n/**\n * å–å¾—æŒ‡å®šè³‡æ–™é¡å‹çš„æ¨™ç±¤\n */\nexport function getCacheTags(type: CacheDataType): string[] {\n    return cacheDataTypes[type].tags;\n}\n\n/**\n * æ ¹æ“šæ¨™ç±¤æ‰¾åˆ°ç›¸é—œçš„è³‡æ–™é¡å‹\n */\nexport function getDataTypesByTag(tag: string): CacheDataType[] {\n    return Object.entries(cacheDataTypes)\n        .filter(([_, config]) => config.tags.includes(tag))\n        .map(([key]) => key as CacheDataType);\n}\n\n/**\n * å–å¾—æ‰€æœ‰å¯ç”¨çš„æ¨™ç±¤\n */\nexport function getAllCacheTags(): string[] {\n    const allTags = Object.values(cacheDataTypes).flatMap((config) => config.tags);\n    return [...new Set(allTags)];\n}\n\n/**\n * å–å¾—å¿«å–é…ç½®æ‘˜è¦ï¼ˆç”¨æ–¼é™¤éŒ¯ï¼‰\n */\nexport function getCacheConfigSummary() {\n    return Object.entries(cacheDataTypes).map(([type, config]) => ({\n        type,\n        ttl: `${config.ttl}s (${config.ttl / 60}min)`,\n        tags: config.tags.join(', '),\n        description: config.description,\n    }));\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 424, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/cache.server.config.ts"],"sourcesContent":["/**\n * å¿«å–ç³»çµ±æœå‹™ç«¯é…ç½®ï¼ˆåƒ…æ¥­å‹™é‚è¼¯ï¼‰\n * - ä¸é‡è¤‡ envï¼šç”¨ getter ç›´æ¥å›å‚³ env å€¼\n * - ä¿ç•™ server è¦†å¯« ttl èˆ‡éµè¦å‰‡ï¼ˆgenerateKeyï¼‰\n * - å‘½åä½¿ç”¨å°å¯«ï¼ˆcamelCaseï¼‰\n */\nimport { env } from '@/env.mjs';\nimport {\n    cacheConfig,                 // client çš„ key è¦å‰‡èˆ‡åŸºæœ¬ ttl/tags\n    getCacheConfig,\n    getCacheTtl as getCacheTtlClientMs,\n    getCacheTags as getCacheTagsClient,\n    getDataTypesByTag,\n    getAllCacheTags,\n    getCacheConfigSummary,\n    type CacheDataType,\n} from './cache.client.config';\n\n// æœå‹™ç«¯è¦†å¯«ï¼šåƒ…ä½œå¿…è¦å·®ç•°ï¼ˆä¾‹ï¼šapiResponseï¼‰\nconst serverTtl = {\n    ...cacheConfig.ttl,\n    apiResponse: env.CACHE_DEFAULT_TTL, // ç§’\n} as const;\n\nconst serverTags = {\n    ...cacheConfig.tags,\n} as const;\n\nexport const serverCacheConfig = {\n    // key è¦å‰‡ï¼ˆæ²¿ç”¨ clientï¼‰\n    redis: cacheConfig.redis,\n\n    // ttl/tags èšåˆï¼ˆserver è¦†å¯«ï¼‰\n    ttl: serverTtl,   // ç§’\n    tags: serverTags,\n\n    // å¿«å–éµå€¼ç”Ÿæˆï¼ˆç´”è¦å‰‡ï¼‰\n    generateKey: (type: CacheDataType, identifier: string, locale?: string): string => {\n        const parts = [cacheConfig.redis.prefix, type, identifier];\n        if (locale) parts.push(locale);\n        return parts.join(cacheConfig.redis.keySeparator);\n    },\n} as const;\n\n// ç›´æ¥è®€ envï¼ˆé¿å…é¡å°„ï¼‰\nexport const isCacheEnabled = (): boolean => env.CACHE_ENABLED;\nexport const isCdnEnabled = (): boolean => env.CACHE_CDN_ENABLED;\nexport const getDefaultTtl = (): number => env.CACHE_DEFAULT_TTL; // ç§’\nexport const getCacheStrategy = (): 'memory' | 'redis' | 'none' => env.I18N_CACHE_STRATEGY;\n\n// å…±ç”¨å°å‡º\nexport {\n    getCacheConfig,\n    getCacheTtlClientMs,\n    getCacheTagsClient,\n    getDataTypesByTag,\n    getAllCacheTags,\n    getCacheConfigSummary,\n    type CacheDataType,\n};\n\n// æœå‹™ç«¯ä¾¿æ·å‡½å¼\nexport function getServerCacheConfig(type: CacheDataType) {\n    const base = getCacheConfig(type);\n    return {\n        type,\n        ttl: serverTtl[type],            // ç§’\n        tags: serverTags[type],\n        description: base.description,\n    };\n}\nexport function getServerCacheTtl(type: CacheDataType): number {\n    return serverTtl[type];            // ç§’\n}\nexport function getServerCacheTtlMs(type: CacheDataType): number {\n    return serverTtl[type] * 1000;     // æ¯«ç§’\n}\nexport function getServerCacheTags(type: CacheDataType): string[] {\n    return serverTags[type];\n}\nexport function getServerCacheConfigSummary() {\n    return (Object.keys(serverTtl) as CacheDataType[]).map((type) => ({\n        type,\n        ttl: `${serverTtl[type]}s (${serverTtl[type] / 60}min)`,\n        tags: serverTags[type].join(', '),\n        description: getCacheConfig(type).description,\n    }));\n}\n\nexport type ServerCacheConfig = typeof serverCacheConfig;"],"names":[],"mappings":"AAAA;;;;;CAKC;;;;;;;;;;;;AACD;AACA;;;AAWA,8BAA8B;AAC9B,MAAM,YAAY;IACd,GAAG,kJAAA,CAAA,cAAW,CAAC,GAAG;IAClB,aAAa,mHAAA,CAAA,MAAG,CAAC,iBAAiB;AACtC;AAEA,MAAM,aAAa;IACf,GAAG,kJAAA,CAAA,cAAW,CAAC,IAAI;AACvB;AAEO,MAAM,oBAAoB;IAC7B,oBAAoB;IACpB,OAAO,kJAAA,CAAA,cAAW,CAAC,KAAK;IAExB,yBAAyB;IACzB,KAAK;IACL,MAAM;IAEN,cAAc;IACd,aAAa,CAAC,MAAqB,YAAoB;QACnD,MAAM,QAAQ;YAAC,kJAAA,CAAA,cAAW,CAAC,KAAK,CAAC,MAAM;YAAE;YAAM;SAAW;QAC1D,IAAI,QAAQ,MAAM,IAAI,CAAC;QACvB,OAAO,MAAM,IAAI,CAAC,kJAAA,CAAA,cAAW,CAAC,KAAK,CAAC,YAAY;IACpD;AACJ;AAGO,MAAM,iBAAiB,IAAe,mHAAA,CAAA,MAAG,CAAC,aAAa;AACvD,MAAM,eAAe,IAAe,mHAAA,CAAA,MAAG,CAAC,iBAAiB;AACzD,MAAM,gBAAgB,IAAc,mHAAA,CAAA,MAAG,CAAC,iBAAiB,EAAE,IAAI;AAC/D,MAAM,mBAAmB,IAAmC,mHAAA,CAAA,MAAG,CAAC,mBAAmB;;AAcnF,SAAS,qBAAqB,IAAmB;IACpD,MAAM,OAAO,CAAA,GAAA,kJAAA,CAAA,iBAAc,AAAD,EAAE;IAC5B,OAAO;QACH;QACA,KAAK,SAAS,CAAC,KAAK;QACpB,MAAM,UAAU,CAAC,KAAK;QACtB,aAAa,KAAK,WAAW;IACjC;AACJ;AACO,SAAS,kBAAkB,IAAmB;IACjD,OAAO,SAAS,CAAC,KAAK,EAAa,IAAI;AAC3C;AACO,SAAS,oBAAoB,IAAmB;IACnD,OAAO,SAAS,CAAC,KAAK,GAAG,MAAU,KAAK;AAC5C;AACO,SAAS,mBAAmB,IAAmB;IAClD,OAAO,UAAU,CAAC,KAAK;AAC3B;AACO,SAAS;IACZ,OAAO,AAAC,OAAO,IAAI,CAAC,WAA+B,GAAG,CAAC,CAAC,OAAS,CAAC;YAC9D;YACA,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC,GAAG,EAAE,SAAS,CAAC,KAAK,GAAG,GAAG,IAAI,CAAC;YACvD,MAAM,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC;YAC5B,aAAa,CAAA,GAAA,kJAAA,CAAA,iBAAc,AAAD,EAAE,MAAM,WAAW;QACjD,CAAC;AACL"}},
    {"offset": {"line": 513, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/config/index.ts"],"sourcesContent":["/**\n * çµ±ä¸€é…ç½®å°å‡º\n * æ•´åˆæ‰€æœ‰é…ç½®ç›¸é—œçš„è¨­å®š\n */\n\n// å°å‡ºç’°å¢ƒè®Šæ•¸é…ç½®\n// export { env } from '../env.mjs';\n\n// å°å‡º API é…ç½®\nexport * from './api.config';\n\n// å°å‡ºæ‡‰ç”¨ç¨‹å¼é…ç½®\nexport * from './app.client.config';\nexport * from './app.server.config';\n\n// å°å‡ºèªç³»é…ç½®\nexport * from './locale.server.config';\nexport * from './locale.client.config';\n\n// å°å‡ºå¿«å–é…ç½®\nexport * from './cache.client.config';\nexport * from './cache.server.config';"],"names":[],"mappings":"AAAA;;;CAGC,GAED,WAAW;AACX,oCAAoC;AAEpC,YAAY;;AACZ;AAEA,WAAW;AACX;AACA;AAEA,SAAS;AACT;AACA;AAEA,SAAS;AACT;AACA"}},
    {"offset": {"line": 554, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/i18n/routing.ts"],"sourcesContent":["import { defineRouting } from 'next-intl/routing';\nimport { serverLocaleConfig } from '@/config/';\nimport { env } from '@/env.mjs';\n\n\nexport const routing = defineRouting({\n    // æ”¯æ´çš„èªç³» - å¾ç’°å¢ƒè®Šæ•¸è®€å–ï¼Œæœƒè¢« API å‹•æ…‹è¦†è“‹\n    locales: serverLocaleConfig.supportedLocales,\n\n    // é è¨­èªç³» - å…ˆç”¨ envï¼Œè‹¥ä¸åœ¨æ”¯æ´æ¸…å–®å…§å‰‡å›é€€ç¬¬ä¸€å€‹\n    defaultLocale: serverLocaleConfig.getValidDefaultLocale(),\n\n\n    // èªç³»å‰ç¶´æ¨¡å¼ - å¾ç’°å¢ƒè®Šæ•¸è®€å–\n    localePrefix: env.LOCALE_PREFIX_MODE,\n\n    // å•Ÿç”¨èªç³»æª¢æ¸¬ - å¾ç’°å¢ƒè®Šæ•¸è®€å–\n    localeDetection: env.LOCALE_DETECTION_ENABLED\n});"],"names":[],"mappings":";;;AAAA;AACA;AAAA;AACA;;;;AAGO,MAAM,UAAU,CAAA,GAAA,0OAAA,CAAA,gBAAa,AAAD,EAAE;IACjC,8BAA8B;IAC9B,SAAS,mJAAA,CAAA,qBAAkB,CAAC,gBAAgB;IAE5C,+BAA+B;IAC/B,eAAe,mJAAA,CAAA,qBAAkB,CAAC,qBAAqB;IAGvD,mBAAmB;IACnB,cAAc,mHAAA,CAAA,MAAG,CAAC,kBAAkB;IAEpC,mBAAmB;IACnB,iBAAiB,mHAAA,CAAA,MAAG,CAAC,wBAAwB;AACjD"}},
    {"offset": {"line": 578, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/features/geo/providers/geoplugin.provider.ts"],"sourcesContent":["/**\n * geoplugin.com åœ°ç†ä½ç½®åµæ¸¬ä¾›æ‡‰å•†å¯¦ä½œ\n *\n * æ­¤æ¨¡çµ„å¯¦ä½œäº† geoplugin.com çš„åœ°ç†ä½ç½®åµæ¸¬æœå‹™ï¼Œå°‡å…¶ API å›æ‡‰è½‰æ›ç‚º\n * æ¨™æº–åŒ–çš„ GeoResult æ ¼å¼ã€‚geoplugin æ˜¯ä¸€å€‹å…è²»çš„ IP åœ°ç†ä½ç½®æœå‹™ï¼Œ\n * ç„¡éœ€ API é‡‘é‘°å³å¯ä½¿ç”¨ï¼Œé©åˆé–‹ç™¼å’Œæ¸¬è©¦ç’°å¢ƒã€‚\n *\n * ä¸»è¦ç‰¹æ€§ï¼š\n * - å…è²»æœå‹™ï¼Œç„¡éœ€è¨»å†Šæˆ– API é‡‘é‘°\n * - æ”¯æ´ IPv4 å’Œ IPv6 åœ°å€æŸ¥è©¢\n * - æä¾›åœ‹å®¶ã€åœ°å€ã€åŸå¸‚ã€ç¶“ç·¯åº¦ç­‰è³‡è¨Š\n * - åŒ…å«æ™‚å€å’Œè²¨å¹£è³‡è¨Š\n * - æ”¯æ´è‡ªè¨‚é€¾æ™‚æ§åˆ¶å’Œ fetch å¯¦ä½œ\n *\n * ä½¿ç”¨é™åˆ¶ï¼š\n * - å…è²»æœå‹™å¯èƒ½æœ‰è«‹æ±‚é »ç‡é™åˆ¶\n * - æº–ç¢ºåº¦å¯èƒ½ä¸å¦‚ä»˜è²»æœå‹™\n * - ç”Ÿç”¢ç’°å¢ƒå»ºè­°æ­é…å¿«å–å’Œå‚™æ´ç­–ç•¥\n *\n * API ç«¯é»ï¼šhttps://www.geoplugin.net/json.gp\n * æ–‡ä»¶ï¼šhttp://www.geoplugin.com/webservices/json\n */\n\nimport { GeoProvider, GeoLookupParams, GeoResult } from '../types/geo.types';\n\n/**\n * geoplugin.com çš„å›æ‡‰å‹åˆ¥ï¼ˆåƒ…åˆ—å¸¸ç”¨æ¬„ä½ï¼Œä¿ç•™é¡å¤–æ¬„ä½ä»¥é˜²æœªä¾†æ“´å……ï¼‰\n */\ninterface GeoPluginResponse {\n    geoplugin_request?: string;        // å›å‚³ä¹‹è«‹æ±‚ IP\n    geoplugin_countryCode?: string;    // åœ‹å®¶ä»£ç¢¼ï¼ˆISO 3166-1 alpha-2ï¼‰\n    geoplugin_countryName?: string;    // åœ‹å®¶åç¨±\n    geoplugin_region?: string;         // å·/çœ/è¡Œæ”¿å€ï¼ˆåç¨±ï¼‰\n    geoplugin_regionCode?: string;     // å·/çœ/è¡Œæ”¿å€ï¼ˆä»£ç¢¼ï¼‰\n    geoplugin_city?: string;           // åŸå¸‚\n    geoplugin_latitude?: string | number;   // ç·¯åº¦\n    geoplugin_longitude?: string | number;  // ç¶“åº¦\n    geoplugin_timezone?: string;       // æ™‚å€ï¼ˆä¾‹å¦‚ Asia/Taipeiï¼‰\n    geoplugin_currencyCode?: string;   // è²¨å¹£ä»£ç¢¼ï¼ˆä¾‹å¦‚ TWDã€USDï¼‰\n    geoplugin_currencySymbol?: string; // è²¨å¹£ç¬¦è™Ÿï¼ˆä¾‹å¦‚ NT$ã€$ï¼‰\n    [key: string]: unknown;            // å…è¨±å…¶ä»–æœªåˆ—èˆ‰çš„æ¬„ä½\n}\n\n/**\n * geoplugin.com Provider å¯¦ä½œ\n * - ç›®æ¨™ï¼šå°‡ geoplugin çš„å›æ‡‰è½‰æ›ç‚ºæ¨™æº–åŒ–çš„ GeoResult\n * - ç‰¹æ€§ï¼šç„¡éœ€ API Keyï¼›é©åˆé–‹ç™¼/æ¸¬è©¦ï¼›ç”Ÿç”¢è«‹æ­é…å¿«å–èˆ‡å‚™æ´ç­–ç•¥\n */\nexport const geoPluginProvider: GeoProvider = {\n    name: 'geoplugin', // ä¾›æ‡‰å•†è­˜åˆ¥å­—ä¸²ï¼ˆæ–¹ä¾¿è¨˜éŒ„èˆ‡åˆ‡æ›ï¼‰\n\n    async lookup({ ip, timeoutMs, fetchImpl }: GeoLookupParams): Promise<GeoResult | null> {\n        const baseUrl = 'https://www.geoplugin.net/json.gp';                   // geoplugin JSON ç«¯é»\n        const url = ip ? `${baseUrl}?ip=${encodeURIComponent(ip)}` : baseUrl;  // å¯é¸ï¼šæŒ‡å®š IPï¼ŒæœªæŒ‡å®šå‰‡ä»¥ä¾†æº IP åˆ¤æ–·\n\n        // é€¾æ™‚æ§åˆ¶ï¼šé¿å…é˜»å¡ SSR / ä¸­ä»‹å±¤\n        const controller = new AbortController();                               // ç”¨æ–¼ä¸­æ­¢ fetch çš„æ§åˆ¶å™¨\n        const timer = setTimeout(() => controller.abort(), Math.max(1, timeoutMs)); // åœ¨ timeoutMs å¾Œä¸­æ­¢è«‹æ±‚\n        const started = Date.now();                                             // è¨˜éŒ„èµ·å§‹æ™‚é–“ä»¥è¨ˆç®—è€—æ™‚\n\n        try {\n            // å¯æ³¨å…¥è‡ªè¨‚ fetchï¼ˆæ¸¬è©¦ç”¨æˆ–åŠ ä»£ç†/é‡è©¦ï¼‰ï¼Œé è¨­ä½¿ç”¨å…¨åŸŸ fetch\n            const fetchFn = fetchImpl ?? fetch;                                 // è‹¥æœªæä¾›å‰‡æ¡ç”¨å…¨åŸŸ fetch\n            const res = await fetchFn(url, {\n                method: 'GET',\n                headers: { Accept: 'application/json' },                        // æ˜ç¢ºè¦æ±‚ JSON\n                signal: controller.signal,                                      // ç¶å®šä¸­æ­¢è¨Šè™Ÿ\n            });\n\n            // HTTP é 2xx è¦–ç‚ºå¤±æ•—ï¼Œé™ç´šç‚º nullï¼ˆä¸æ‹‹ä¾‹å¤–ï¼Œä¿æŒä¸Šå±¤æµç¨‹å¹³é †ï¼‰\n            if (!res.ok) {\n                return null;                                                    // å›å‚³ null è¡¨ç¤ºæœªå–å¾—æœ‰æ•ˆè³‡æ–™\n            }\n\n            const json: GeoPluginResponse = await res.json();                   // è§£æ JSON å›æ‡‰\n            const elapsedMs = Date.now() - started;                             // è¨ˆç®—æœ¬æ¬¡è«‹æ±‚è€—æ™‚ï¼ˆæ¯«ç§’ï¼‰\n\n            // å°‡ geoplugin å›æ‡‰æ˜ å°„åˆ°æ¨™æº– GeoResult\n            const result: GeoResult = {\n                ip: safeString(json?.geoplugin_request),                        // åµæ¸¬åˆ°çš„ IPï¼ˆè‹¥å›å‚³ï¼‰\n                countryCode: safeString(json?.geoplugin_countryCode) ?? null,   // åœ‹å®¶ä»£ç¢¼ï¼ˆå¤±æ•—å‰‡ nullï¼‰\n                countryName: safeString(json?.geoplugin_countryName) ?? null,   // åœ‹å®¶åç¨±\n                region: safeString(json?.geoplugin_region)                      // å„ªå…ˆæ¡ç”¨åç¨±\n                    ?? safeString(json?.geoplugin_regionCode)               // æ¬¡é¸ä»£ç¢¼\n                    ?? null,                                                // æœ€çµ‚ç„¡è³‡æ–™\n                city: safeString(json?.geoplugin_city) ?? null,                 // åŸå¸‚\n                latitude: safeNumber(json?.geoplugin_latitude),                 // ç·¯åº¦ï¼ˆå­—ä¸²/æ•¸å­— â†’ number|nullï¼‰\n                longitude: safeNumber(json?.geoplugin_longitude),               // ç¶“åº¦ï¼ˆå­—ä¸²/æ•¸å­— â†’ number|nullï¼‰\n                timeZone: safeString(json?.geoplugin_timezone) ?? null,         // æ™‚å€ï¼ˆä¾‹å¦‚ Asia/Taipeiï¼‰\n                currency: normalizeCurrency(json),                               // è²¨å¹£è³‡è¨Šï¼ˆçš†ç„¡æ™‚å›å‚³ nullï¼‰\n                raw: json,                                                      // ä¿ç•™åŸå§‹å›æ‡‰ä»¥åˆ©é™¤éŒ¯ï¼ˆä¸å»ºè­°ç›´æ¥æ›éœ²è‡³å‰ç«¯ï¼‰\n                provider: 'geoplugin',                                          // ä¾›æ‡‰å•†è­˜åˆ¥ï¼ˆçµ±ä¸€æ ¼å¼ï¼‰\n                fromCache: false,                                               // Provider æœ¬èº«ä¸è™•ç†å¿«å–ï¼›ç”±å¤–å±¤æœå‹™è² è²¬\n                elapsedMs,                                                      // æœ¬æ¬¡æŸ¥è©¢è€—æ™‚ï¼ˆæ¯«ç§’ï¼‰\n            };\n\n            return result;                                                      // å›å‚³æ¨™æº–åŒ–çµæœ\n        } catch {\n            // åŒ…å«é€¾æ™‚ï¼ˆAbortErrorï¼‰åœ¨å…§çš„ä»»ä½•éŒ¯èª¤çš†é™ç´šç‚º nullï¼Œé¿å…ä¸­æ–·æµç¨‹\n            return null;                                                        // å›å‚³ null äº¤ç”±ä¸Šå±¤å…œåº•\n        } finally {\n            clearTimeout(timer);                                                // æ¸…ç†é€¾æ™‚è¨ˆæ™‚å™¨ï¼Œé¿å…è³‡æºæ´©æ¼\n        }\n    },\n};\n\n/* å·¥å…·å‡½å¼ï¼ˆç´”å‡½å¼ï¼Œä¾¿æ–¼æ¸¬è©¦èˆ‡é‡ç”¨ï¼‰ */\n\n/**\n * å°‡æœªçŸ¥å€¼å®‰å…¨è½‰ç‚ºéç©ºå­—ä¸²\n * - ç©ºå­—ä¸²ã€nullã€undefined çš†å›å‚³ undefined\n */\nfunction safeString(val: unknown): string | undefined {\n    if (val === null || val === undefined) return undefined;                    // ç„¡å€¼ç›´æ¥å› undefined\n    const s = String(val).trim();                                               // è½‰å­—ä¸²ä¸¦å»é™¤å‰å¾Œç©ºç™½\n    return s.length ? s : undefined;                                            // ç©ºå­—ä¸²è¦–ç‚ºç„¡æ•ˆ\n}\n\n/**\n * å°‡æœªçŸ¥å€¼å®‰å…¨è½‰ç‚º number\n * - éæœ‰é™æ•¸å­—æˆ–ç„¡å€¼å›å‚³ null\n */\nfunction safeNumber(val: unknown): number | null {\n    if (val === null || val === undefined) return null;                         // ç„¡å€¼å› null\n    const n = Number(val);                                                      // å˜—è©¦è½‰ç‚ºæ•¸å­—\n    return Number.isFinite(n) ? n : null;                                       // éæœ‰é™æ•¸å­—è¦–ç‚ºç„¡æ•ˆ\n}\n\n/**\n * æ­£è¦åŒ– geoplugin çš„è²¨å¹£è³‡è¨Š\n * - è‹¥ code èˆ‡ symbol çš†ç¼ºå¤±å‰‡å›å‚³ nullï¼Œé¿å…ç”¢ç”Ÿç©ºç‰©ä»¶\n */\nfunction normalizeCurrency(json: GeoPluginResponse): { code?: string | null; symbol?: string | null } | null {\n    const code = safeString(json?.geoplugin_currencyCode) ?? null;              // è²¨å¹£ä»£ç¢¼ï¼ˆä¾‹å¦‚ TWDã€USDï¼‰\n    const symbol = safeString(json?.geoplugin_currencySymbol) ?? null;          // è²¨å¹£ç¬¦è™Ÿï¼ˆä¾‹å¦‚ NT$ã€$ï¼‰\n    if (code === null && symbol === null) return null;                          // å…©è€…çš†ç„¡ â†’ è¦–ç‚ºç„¡è³‡æ–™\n    return { code, symbol };                                                    // è‡³å°‘æœ‰ä¸€é …å‰‡å›å‚³ç‰©ä»¶\n}"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;CAqBC;;;AA2BM,MAAM,oBAAiC;IAC1C,MAAM;IAEN,MAAM,QAAO,EAAE,EAAE,EAAE,SAAS,EAAE,SAAS,EAAmB;QACtD,MAAM,UAAU,qCAAuD,oBAAoB;QAC3F,MAAM,MAAM,KAAK,GAAG,QAAQ,IAAI,EAAE,mBAAmB,KAAK,GAAG,SAAU,yBAAyB;QAEhG,sBAAsB;QACtB,MAAM,aAAa,IAAI,mBAAiD,kBAAkB;QAC1F,MAAM,QAAQ,WAAW,IAAM,WAAW,KAAK,IAAI,KAAK,GAAG,CAAC,GAAG,aAAa,oBAAoB;QAChG,MAAM,UAAU,KAAK,GAAG,IAAgD,cAAc;QAEtF,IAAI;YACA,uCAAuC;YACvC,MAAM,UAAU,aAAa,OAAuC,kBAAkB;YACtF,MAAM,MAAM,MAAM,QAAQ,KAAK;gBAC3B,QAAQ;gBACR,SAAS;oBAAE,QAAQ;gBAAmB;gBACtC,QAAQ,WAAW,MAAM;YAC7B;YAEA,0CAA0C;YAC1C,IAAI,CAAC,IAAI,EAAE,EAAE;gBACT,OAAO,MAAyD,oBAAoB;YACxF;YAEA,MAAM,OAA0B,MAAM,IAAI,IAAI,IAAsB,aAAa;YACjF,MAAM,YAAY,KAAK,GAAG,KAAK,SAAqC,eAAe;YAEnF,gCAAgC;YAChC,MAAM,SAAoB;gBACtB,IAAI,WAAW,MAAM;gBACrB,aAAa,WAAW,MAAM,0BAA0B;gBACxD,aAAa,WAAW,MAAM,0BAA0B;gBACxD,QAAQ,WAAW,MAAM,kBAAuC,SAAS;oBAClE,WAAW,MAAM,sBAAoC,OAAO;oBAC5D;gBACP,MAAM,WAAW,MAAM,mBAAmB;gBAC1C,UAAU,WAAW,MAAM;gBAC3B,WAAW,WAAW,MAAM;gBAC5B,UAAU,WAAW,MAAM,uBAAuB;gBAClD,UAAU,kBAAkB;gBAC5B,KAAK;gBACL,UAAU;gBACV,WAAW;gBACX;YACJ;YAEA,OAAO,QAA6D,UAAU;QAClF,EAAE,OAAM;YACJ,0CAA0C;YAC1C,OAAO,MAA6D,iBAAiB;QACzF,SAAU;YACN,aAAa,QAAuD,iBAAiB;QACzF;IACJ;AACJ;AAEA,qBAAqB,GAErB;;;CAGC,GACD,SAAS,WAAW,GAAY;IAC5B,IAAI,QAAQ,QAAQ,QAAQ,WAAW,OAAO,WAA8B,kBAAkB;IAC9F,MAAM,IAAI,OAAO,KAAK,IAAI,IAAkD,aAAa;IACzF,OAAO,EAAE,MAAM,GAAG,IAAI,WAAsD,UAAU;AAC1F;AAEA;;;CAGC,GACD,SAAS,WAAW,GAAY;IAC5B,IAAI,QAAQ,QAAQ,QAAQ,WAAW,OAAO,MAA8B,WAAW;IACvF,MAAM,IAAI,OAAO,MAA2D,SAAS;IACrF,OAAO,OAAO,QAAQ,CAAC,KAAK,IAAI,MAA4C,YAAY;AAC5F;AAEA;;;CAGC,GACD,SAAS,kBAAkB,IAAuB;IAC9C,MAAM,OAAO,WAAW,MAAM,2BAA2B,MAAmB,mBAAmB;IAC/F,MAAM,SAAS,WAAW,MAAM,6BAA6B,MAAe,iBAAiB;IAC7F,IAAI,SAAS,QAAQ,WAAW,MAAM,OAAO,MAA+B,eAAe;IAC3F,OAAO;QAAE;QAAM;IAAO,GAAsD,aAAa;AAC7F"}},
    {"offset": {"line": 686, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/cache/memory-adapter.ts"],"sourcesContent":["/**\n * è¨˜æ†¶é«”å¿«å–é©é…å™¨å¯¦ä½œ\n *\n * åŸºæ–¼ JavaScript Map å¯¦ä½œçš„è¨˜æ†¶é«”å¿«å–ç³»çµ±ï¼Œæ”¯æ´ TTLï¼ˆç”Ÿå­˜æ™‚é–“ï¼‰å’Œæ¨™ç±¤ç´¢å¼•åŠŸèƒ½ã€‚\n * é©åˆé–‹ç™¼ç’°å¢ƒæˆ–å°å‹æ‡‰ç”¨ä½¿ç”¨ï¼Œè³‡æ–™å­˜å„²åœ¨æ‡‰ç”¨ç¨‹å¼è¨˜æ†¶é«”ä¸­ï¼Œé‡å•Ÿå¾Œæœƒéºå¤±ã€‚\n *\n * ä¸»è¦ç‰¹æ€§ï¼š\n * - TTL æ”¯æ´ï¼šå¯è¨­å®šå¿«å–é …ç›®çš„éæœŸæ™‚é–“\n * - æ¨™ç±¤ç´¢å¼•ï¼šæ”¯æ´æŒ‰æ¨™ç±¤æ‰¹é‡åˆªé™¤å¿«å–é …ç›®\n * - è‡ªå‹•æ¸…ç†ï¼šè®€å–æ™‚è‡ªå‹•æ¸…ç†éæœŸé …ç›®\n * - å‹åˆ¥å®‰å…¨ï¼šæ”¯æ´æ³›å‹ï¼Œç¢ºä¿å‹åˆ¥å®‰å…¨\n *\n * æ³¨æ„äº‹é …ï¼š\n * - è¨˜æ†¶é«”ä½¿ç”¨é‡æœƒéš¨å¿«å–é …ç›®å¢åŠ è€Œå¢é•·\n * - æ‡‰ç”¨ç¨‹å¼é‡å•Ÿå¾Œæ‰€æœ‰å¿«å–è³‡æ–™æœƒéºå¤±\n * - é©åˆå–®æ©Ÿéƒ¨ç½²ï¼Œä¸æ”¯æ´åˆ†æ•£å¼å¿«å–\n */\n\nimport type { CacheAdapter, CacheSetOptions } from './types';\n\n/**\n * å¿«å–é …ç›®çš„å…§éƒ¨è³‡æ–™çµæ§‹\n */\ntype StoreItem = {\n    /** å¿«å–çš„å€¼ï¼Œå¯ä»¥æ˜¯ä»»æ„å‹åˆ¥ */\n    value: unknown;\n    /** éæœŸæ™‚é–“æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œundefined è¡¨ç¤ºæ°¸ä¸éæœŸ */\n    expireAt?: number;\n    /** é—œè¯çš„æ¨™ç±¤é›†åˆï¼Œç”¨æ–¼æ‰¹é‡æ“ä½œ */\n    tags: Set<string>;\n};\n\n/**\n * è¨˜æ†¶é«”å¿«å–é©é…å™¨\n *\n * å¯¦ä½œ CacheAdapter ä»‹é¢ï¼Œæä¾›åŸºæ–¼è¨˜æ†¶é«”çš„å¿«å–åŠŸèƒ½ã€‚\n * ä½¿ç”¨ Map ä½œç‚ºä¸»è¦å­˜å„²çµæ§‹ï¼Œä¸¦ç¶­è­·æ¨™ç±¤åˆ°éµå€¼çš„åå‘ç´¢å¼•ã€‚\n */\nexport class MemoryCacheAdapter implements CacheAdapter {\n    /** ä¸»è¦å­˜å„²çµæ§‹ï¼šéµå€¼ -> å¿«å–é …ç›® */\n    private store = new Map<string, StoreItem>();\n    /** æ¨™ç±¤ç´¢å¼•ï¼šæ¨™ç±¤ -> åŒ…å«è©²æ¨™ç±¤çš„éµå€¼é›†åˆ */\n    private tagIndex = new Map<string, Set<string>>();\n\n    /**\n     * å–å¾—å¿«å–å€¼\n     *\n     * @template T å¿«å–å€¼çš„å‹åˆ¥\n     * @param key å¿«å–éµå€¼\n     * @returns å¿«å–çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨æˆ–å·²éæœŸå‰‡å›å‚³ null\n     */\n    async get<T>(key: string): Promise<T | null> {\n        const item = this.store.get(key);\n        if (!item) return null;\n\n        // æª¢æŸ¥æ˜¯å¦éæœŸï¼ŒéæœŸå‰‡è‡ªå‹•æ¸…ç†\n        if (item.expireAt && Date.now() > item.expireAt) {\n            this.evict(key, item);\n            return null;\n        }\n\n        return item.value as T;\n    }\n\n    /**\n     * è¨­å®šå¿«å–å€¼\n     *\n     * @template T å¿«å–å€¼çš„å‹åˆ¥\n     * @param key å¿«å–éµå€¼\n     * @param value è¦å¿«å–çš„å€¼\n     * @param options å¿«å–é¸é …ï¼ŒåŒ…å« TTL å’Œæ¨™ç±¤\n     */\n    async set<T>(key: string, value: T, options?: CacheSetOptions): Promise<void> {\n        const ttlSec = options?.ttl ?? 0;\n        const expireAt = ttlSec > 0 ? Date.now() + ttlSec * 1000 : undefined;\n        const tags = new Set(options?.tags ?? []);\n\n        // å¦‚æœéµå€¼å·²å­˜åœ¨ï¼Œå…ˆæ¸…ç†èˆŠçš„æ¨™ç±¤ç´¢å¼•\n        const old = this.store.get(key);\n        if (old) this.unindexTags(key, old.tags);\n\n        // è¨­å®šæ–°å€¼ä¸¦å»ºç«‹æ¨™ç±¤ç´¢å¼•\n        this.store.set(key, { value, expireAt, tags });\n        this.indexTags(key, tags);\n    }\n\n    /**\n     * åˆªé™¤æŒ‡å®šéµå€¼çš„å¿«å–\n     *\n     * @param key è¦åˆªé™¤çš„å¿«å–éµå€¼\n     */\n    async del(key: string): Promise<void> {\n        const item = this.store.get(key);\n        if (!item) return;\n\n        // æ¸…ç†æ¨™ç±¤ç´¢å¼•ä¸¦åˆªé™¤é …ç›®\n        this.unindexTags(key, item.tags);\n        this.store.delete(key);\n    }\n\n    /**\n     * æŒ‰æ¨™ç±¤æ‰¹é‡åˆªé™¤å¿«å–\n     *\n     * åˆªé™¤æ‰€æœ‰åŒ…å«æŒ‡å®šæ¨™ç±¤çš„å¿«å–é …ç›®ï¼Œå¸¸ç”¨æ–¼ç›¸é—œè³‡æ–™çš„æ‰¹é‡å¤±æ•ˆã€‚\n     *\n     * @param tag è¦åˆªé™¤çš„æ¨™ç±¤\n     */\n    async delByTag(tag: string): Promise<void> {\n        const keys = this.tagIndex.get(tag);\n        if (!keys) return;\n\n        // éæ­·æ‰€æœ‰åŒ…å«è©²æ¨™ç±¤çš„éµå€¼ä¸¦åˆªé™¤\n        for (const key of keys) {\n            const item = this.store.get(key);\n            if (!item) continue;\n            this.unindexTags(key, item.tags);\n            this.store.delete(key);\n        }\n\n        // æ¸…ç†æ¨™ç±¤ç´¢å¼•\n        this.tagIndex.delete(tag);\n    }\n\n    /**\n     * æ¸…ç©ºæ‰€æœ‰å¿«å–\n     *\n     * åˆªé™¤æ‰€æœ‰å¿«å–é …ç›®å’Œæ¨™ç±¤ç´¢å¼•ï¼Œé‡ç½®å¿«å–ç‹€æ…‹ã€‚\n     */\n    async clear(): Promise<void> {\n        this.store.clear();\n        this.tagIndex.clear();\n    }\n\n    /**\n     * æ¸…ç†éæœŸé …ç›®\n     *\n     * å…§éƒ¨æ–¹æ³•ï¼Œç”¨æ–¼æ¸…ç†éæœŸçš„å¿«å–é …ç›®å’Œç›¸é—œçš„æ¨™ç±¤ç´¢å¼•ã€‚\n     *\n     * @private\n     * @param key è¦æ¸…ç†çš„éµå€¼\n     * @param item è¦æ¸…ç†çš„å¿«å–é …ç›®\n     */\n    private evict(key: string, item: StoreItem) {\n        this.unindexTags(key, item.tags);\n        this.store.delete(key);\n    }\n\n    /**\n     * å»ºç«‹æ¨™ç±¤ç´¢å¼•\n     *\n     * ç‚ºæŒ‡å®šéµå€¼çš„æ¨™ç±¤å»ºç«‹åå‘ç´¢å¼•ï¼Œç”¨æ–¼æ”¯æ´æŒ‰æ¨™ç±¤æŸ¥è©¢å’Œåˆªé™¤ã€‚\n     *\n     * @private\n     * @param key éµå€¼\n     * @param tags æ¨™ç±¤é›†åˆ\n     */\n    private indexTags(key: string, tags: Set<string>) {\n        for (const tag of tags) {\n            if (!this.tagIndex.has(tag)) this.tagIndex.set(tag, new Set());\n            this.tagIndex.get(tag)!.add(key);\n        }\n    }\n\n    /**\n     * æ¸…ç†æ¨™ç±¤ç´¢å¼•\n     *\n     * å¾æ¨™ç±¤ç´¢å¼•ä¸­ç§»é™¤æŒ‡å®šéµå€¼çš„é—œè¯ï¼Œå¦‚æœæ¨™ç±¤ä¸‹æ²’æœ‰å…¶ä»–éµå€¼å‰‡åˆªé™¤è©²æ¨™ç±¤ã€‚\n     *\n     * @private\n     * @param key éµå€¼\n     * @param tags æ¨™ç±¤é›†åˆ\n     */\n    private unindexTags(key: string, tags: Set<string>) {\n        for (const tag of tags) {\n            const set = this.tagIndex.get(tag);\n            if (!set) continue;\n            set.delete(key);\n            // å¦‚æœæ¨™ç±¤ä¸‹æ²’æœ‰å…¶ä»–éµå€¼ï¼Œåˆªé™¤è©²æ¨™ç±¤ç´¢å¼•\n            if (set.size === 0) this.tagIndex.delete(tag);\n        }\n    }\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 832, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/lib/cache/factory.ts"],"sourcesContent":["/**\n * å¿«å–é©é…å™¨å·¥å» æ¨¡çµ„\n *\n * æ­¤æ¨¡çµ„æä¾›çµ±ä¸€çš„å¿«å–é©é…å™¨å»ºç«‹ä»‹é¢ï¼Œæ ¹æ“šç’°å¢ƒè®Šæ•¸é…ç½®å‹•æ…‹é¸æ“‡å¿«å–ç­–ç•¥ã€‚\n * æ”¯æ´è¨˜æ†¶é«”å¿«å–ã€Redis å¿«å–æˆ–ç„¡å¿«å–æ¨¡å¼ï¼Œä¸¦ä½¿ç”¨å–®ä¾‹æ¨¡å¼ç¢ºä¿æ•´å€‹æ‡‰ç”¨ç¨‹å¼\n * å…±ç”¨åŒä¸€å€‹å¿«å–å¯¦ä¾‹ï¼Œé¿å…é‡è¤‡åˆå§‹åŒ–å’Œè³‡æºæµªè²»ã€‚\n *\n * æ”¯æ´çš„å¿«å–ç­–ç•¥ï¼š\n * - memory: ä½¿ç”¨è¨˜æ†¶é«”å¿«å–ï¼Œé©åˆé–‹ç™¼ç’°å¢ƒæˆ–å°å‹æ‡‰ç”¨\n * - redis: ä½¿ç”¨ Redis å¿«å–ï¼Œé©åˆç”Ÿç”¢ç’°å¢ƒæˆ–åˆ†æ•£å¼éƒ¨ç½²ï¼ˆå¾…å¯¦ä½œï¼‰\n * - none: ç„¡å¿«å–æ¨¡å¼ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯ no-opï¼Œé©åˆæ¸¬è©¦æˆ–ç‰¹æ®Šå ´æ™¯\n */\n\nimport type { CacheAdapter } from './types';\nimport { MemoryCacheAdapter } from './memory-adapter';\nimport { env } from '@/env.mjs';\n\n// å–®ä¾‹å¯¦ä¾‹ï¼Œç¢ºä¿æ•´å€‹æ‡‰ç”¨ç¨‹å¼å…±ç”¨åŒä¸€å€‹å¿«å–é©é…å™¨\nlet singleton: CacheAdapter | null = null;\n\n/**\n * å–å¾—å¿«å–é©é…å™¨å¯¦ä¾‹\n *\n * æ ¹æ“šç’°å¢ƒè®Šæ•¸ I18N_CACHE_STRATEGY çš„è¨­å®šï¼Œå‹•æ…‹å»ºç«‹å°æ‡‰çš„å¿«å–é©é…å™¨ã€‚\n * ä½¿ç”¨å–®ä¾‹æ¨¡å¼ï¼Œé¦–æ¬¡å‘¼å«æ™‚å»ºç«‹å¯¦ä¾‹ï¼Œå¾ŒçºŒå‘¼å«ç›´æ¥å›å‚³å·²å»ºç«‹çš„å¯¦ä¾‹ã€‚\n *\n * @returns {CacheAdapter} å¿«å–é©é…å™¨å¯¦ä¾‹ï¼Œå¯¦ä½œçµ±ä¸€çš„å¿«å–ä»‹é¢\n */\nexport function getCacheAdapter(): CacheAdapter {\n    // å¦‚æœå·²æœ‰å¯¦ä¾‹ï¼Œç›´æ¥å›å‚³ï¼Œé¿å…é‡è¤‡å»ºç«‹\n    if (singleton) return singleton;\n\n    // ç›´æ¥è®€ envï¼Œé¿å…ä¾è³´å¦ä¸€å±¤ config å¸¸é‡\n    const strategy = env.I18N_CACHE_STRATEGY; // 'memory' | 'redis' | 'none'\n\n    if (strategy === 'memory') {\n        // è¨˜æ†¶é«”å¿«å–ï¼šé©åˆé–‹ç™¼ç’°å¢ƒï¼Œè³‡æ–™å­˜åœ¨æ‡‰ç”¨ç¨‹å¼è¨˜æ†¶é«”ä¸­\n        singleton = new MemoryCacheAdapter();\n    } else if (strategy === 'redis') {\n        // Redis å¿«å–ï¼šé©åˆç”Ÿç”¢ç’°å¢ƒï¼Œæ”¯æ´åˆ†æ•£å¼å¿«å–\n        // TODO: ä¹‹å¾Œæ¥ RedisAdapter\n        singleton = new MemoryCacheAdapter();\n    } else {\n        // ç„¡å¿«å–æ¨¡å¼ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯ no-opï¼Œé©åˆæ¸¬è©¦æˆ–ç¦ç”¨å¿«å–çš„å ´æ™¯\n        singleton = {\n            async get() { return null; },\n            async set() { /* no-op */ },\n            async del() { /* no-op */ },\n            async delByTag() { /* no-op */ },\n            async clear() { /* no-op */ }\n        };\n    }\n    return singleton;\n}"],"names":[],"mappings":"AAAA;;;;;;;;;;;CAWC;;;AAGD;AACA;;;AAEA,0BAA0B;AAC1B,IAAI,YAAiC;AAU9B,SAAS;IACZ,qBAAqB;IACrB,IAAI,WAAW,OAAO;IAEtB,4BAA4B;IAC5B,MAAM,WAAW,mHAAA,CAAA,MAAG,CAAC,mBAAmB,EAAE,8BAA8B;IAExE,IAAI,aAAa,UAAU;QACvB,4BAA4B;QAC5B,YAAY,IAAI,gJAAA,CAAA,qBAAkB;IACtC,OAAO,IAAI,aAAa,SAAS;QAC7B,0BAA0B;QAC1B,yBAAyB;QACzB,YAAY,IAAI,gJAAA,CAAA,qBAAkB;IACtC,OAAO;QACH,kCAAkC;QAClC,YAAY;YACR,MAAM;gBAAQ,OAAO;YAAM;YAC3B,MAAM,QAAoB;YAC1B,MAAM,QAAoB;YAC1B,MAAM,aAAyB;YAC/B,MAAM,UAAsB;QAChC;IACJ;IACA,OAAO;AACX"}},
    {"offset": {"line": 882, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/features/geo/services/geo.service.ts"],"sourcesContent":["/**\n * GeoServiceï¼ˆåœ°ç†ä½ç½®åµæ¸¬æœå‹™ï¼‰\n *\n * ä½œç”¨èˆ‡èªªæ˜ï¼š\n * - æä¾›å°å¤–ã€Œå–®ä¸€å…¥å£ã€ä»¥å–å¾—ä½¿ç”¨è€…çš„åœ°ç†è³‡è¨Šï¼ˆåœ‹å®¶ä»£ç¢¼ç‚ºä¸»ï¼‰ã€‚\n * - å°è£ç¬¬ä¸‰æ–¹ä¾›æ‡‰å•†ï¼ˆç›®å‰ geopluginï¼‰å‘¼å«é‚è¼¯ï¼Œä¸¦çµ±ä¸€å›å‚³æ¨™æº–åŒ–çµæœ GeoResultã€‚\n * - å…§å»ºé€¾æ™‚æ§åˆ¶ï¼ˆé¿å… SSR / Middleware è¢«å¤–éƒ¨ API é˜»å¡ï¼‰ã€éŒ¯èª¤é™ç´šï¼ˆå¤±æ•—å›å‚³ nullï¼‰ã€‚\n * - æ•´åˆå…±ç”¨å¿«å–ç³»çµ±ï¼ˆCacheAdapterï¼‰ï¼šæ”¯æ´ memory/redis/noneï¼Œä¸¦å€åˆ†æˆåŠŸèˆ‡å¤±æ•—çµæœ TTLã€‚\n * - å…·ç²—ç²’åº¦ IP å¿«å–éµï¼ˆ/24 for IPv4ã€å‰ 4 æ®µ for IPv6ï¼‰ä»¥é™ä½ç¢ç‰‡èˆ‡éš±ç§é¢¨éšªã€‚\n * - æä¾›ä¾¿æ· APIï¼šdetectGeoï¼ˆå®Œæ•´è³‡è¨Šï¼‰ã€detectCountryï¼ˆåªå–åœ‹ç¢¼ï¼‰ã€‚\n * - é ç•™ tagsï¼ˆ'geo', providerNameï¼‰ï¼Œæ–¹ä¾¿å¾ŒçºŒæ‰¹æ¬¡æ¸…é™¤å¿«å–ï¼ˆdelByTagï¼‰ã€‚\n *\n * ä½•æ™‚ä½¿ç”¨ï¼š\n * - Middleware ä¸­é€²è¡Œã€Œå»ºè­°èªç³»/ç«™é»ã€çš„å‰ç½®åµæ¸¬èˆ‡ Cookie å¯«å…¥ã€‚\n * - SSR æµç¨‹ä¸­éœ€è¦ä¾åœ‹åˆ¥åšå…§å®¹æˆ–èªç³»çš„åˆæ­¥æ±ºç­–ã€‚\n *\n * é‡è¦è¨­è¨ˆï¼š\n * - æˆåŠŸçµæœ TTL è¼ƒé•·ï¼ˆé è¨­ 15 åˆ†é˜ï¼‰ã€å¤±æ•—çµæœï¼ˆnullï¼‰è² é¢å¿«å– TTL è¼ƒçŸ­ï¼ˆé è¨­ 5 åˆ†é˜ï¼‰ã€‚\n * - fromCache èˆ‡ elapsedMs ç”±æœå‹™å±¤è³¦å€¼ï¼Œå°ä¸Šå±¤æä¾›å¯è§€æ¸¬æ€§èˆ‡é™¤éŒ¯è³‡è¨Šã€‚\n * - å¯é€é forceRefresh é¿é–‹å¿«å–ï¼ˆé™¤éŒ¯/ç·Šæ€¥é‡æŸ¥ï¼‰ã€‚\n */\n\nimport {geoPluginProvider} from '../providers/geoplugin.provider';\nimport type {GeoLookupParams, GeoProvider, GeoResult} from '../types/geo.types';\nimport {getCacheAdapter} from '@/lib/cache/factory';\n\n// é è¨­é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰ã€‚é¿å… SSR / Middleware å› ç¬¬ä¸‰æ–¹ API å¡ä½ã€‚\nconst GEO_DEFAULT_TIMEOUT_MS = 800;\n\n// æˆåŠŸçµæœå¿«å–æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰ã€‚Geo IP é€šå¸¸ç©©å®šï¼Œå¯è¨­å®šè¼ƒé•·ï¼ˆä¾‹å¦‚ 15 åˆ†é˜ï¼‰ã€‚\nconst GEO_SUCCESS_TTL_MS = 15 * 60 * 1000;\n\n// å¤±æ•—ï¼ˆnullï¼‰çµæœçš„ã€Œè² é¢å¿«å–ã€æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰ã€‚çŸ­ä¸€äº›å¯é™ä½é›ªå´©èˆ‡é‡è©¦é¢¨æš´ï¼ˆä¾‹å¦‚ 5 åˆ†é˜ï¼‰ã€‚\nconst GEO_NEGATIVE_TTL_MS = 5 * 60 * 1000;\n\n/**\n * å¿«å–ç³»çµ±ï¼ˆCacheAdapterï¼‰ä½¿ç”¨ç§’ç‚ºå–®ä½ï¼Œå› æ­¤éœ€å°‡æ¯«ç§’è½‰ç‚ºç§’ã€‚\n * - æœ€å°å›å‚³ 1 ç§’ï¼Œé¿å… 0 å°è‡´ç«‹å³éæœŸã€‚\n */\nfunction msToSec(ms: number): number {\n    return Math.max(1, Math.ceil(ms / 1000));\n}\n\n/**\n * å°‡ IP æ­£è¦åŒ–ç‚ºè¼ƒç²—ç²’åº¦çš„ keyï¼Œé¿å…å¿«å–ç¢ç‰‡éå¤šèˆ‡éš±ç§é¢¨éšªã€‚\n * - IPv4: a.b.c.d â†’ a.b.c.0\n * - IPv6: å–å‰ 4 æ®µ â†’ xxxx:xxxx:xxxx:xxxx::\n * - æœªæŒ‡å®š IPï¼šä½¿ç”¨ 'self'\n */\nfunction toCoarseIpKey(ip?: string): string {\n    if (!ip) return 'self';\n    if (/^\\d{1,3}(\\.\\d{1,3}){3}$/.test(ip)) {\n        const [a, b, c] = ip.split('.');\n        return `${a}.${b}.${c}.0`;\n        // IPv4 ä½¿ç”¨ /24 ç²’åº¦ï¼Œæœ‰æ•ˆé™ä½ key æ•¸é‡ï¼ŒåŒæ™‚ä»å…·å€åŸŸä»£è¡¨æ€§ã€‚\n    }\n    if (ip.includes(':')) {\n        return ip.split(':').slice(0, 4).join(':') + '::';\n        // IPv6 åªå–å‰ 4 æ®µä½œç‚ºç²—ç²’åº¦ï¼Œç²¾ç¢ºæ€§èˆ‡éš±ç§çš„æŠ˜è¡·ã€‚\n    }\n    return ip;\n}\n\n// ...  code ...\n\nexport type DetectOptions = {\n    ip?: string;               // æŒ‡å®šæŸ¥è©¢ IPï¼›ä¸å¡«å‰‡ç”±ä¾›æ‡‰å•†ä»¥ä¾†æº IP åˆ¤æ–·\n    timeoutMs?: number;        // è‡ªè¨‚é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰ï¼Œä¸å¡«æ¡ç”¨é è¨­\n    forceRefresh?: boolean;    // å¼·åˆ¶å¿½ç•¥å¿«å–ï¼ˆé™¤éŒ¯/ç·Šæ€¥ï¼‰\n    fetchImpl?: typeof fetch;  // å¯æ³¨å…¥ fetchï¼ˆæ¸¬è©¦/ä»£ç†ï¼‰\n};\n\nexport class GeoService {\n    // é è¨­ä¾›æ‡‰å•†ï¼šgeopluginã€‚ä¹‹å¾Œå¯ä¾ç’°å¢ƒè®Šæ•¸æ”¹ç‚º ipapiã€ipinfo...ç­‰ã€‚\n    private provider: GeoProvider = geoPluginProvider;\n\n    // ä½¿ç”¨å°ˆæ¡ˆçš„å¿«å–æŠ½è±¡å±¤ï¼ˆå¯åˆ‡æ› memory/redis/noneï¼‰\n    private cache = getCacheAdapter();\n\n    /**\n     * å–å¾—å®Œæ•´åœ°ç†è³‡è¨Šï¼ˆæ¨™æº–åŒ–çµæœï¼‰ã€‚\n     * - å…·å‚™ï¼šå¿«å–ã€é€¾æ™‚ã€é™ç´šï¼ˆå¤±æ•—å› nullï¼‰\n     * - å¿«å– Key è¨­è¨ˆï¼šgeo:{provider}:{coarseIpKey}\n     */\n    async detectGeo(opts: DetectOptions = {}): Promise<GeoResult | null> {\n        const { ip, forceRefresh, fetchImpl } = opts;\n        const timeoutMs = opts.timeoutMs ?? GEO_DEFAULT_TIMEOUT_MS;\n        const key = `geo:${this.provider.name}:${toCoarseIpKey(ip)}`;\n\n        // 1) è®€å–å¿«å–ï¼ˆè‹¥éå¼·åˆ¶åˆ·æ–°ï¼‰\n        //   - CacheAdapter.get è¦æ ¼ï¼šå›å‚³ T | nullï¼ˆæ²’æœ‰ undefinedï¼‰\n        if (!forceRefresh) {\n            const cached = await this.cache.get<GeoResult | null>(key);\n            if (cached !== null) {\n                // å‘½ä¸­å¿«å–ï¼šè£œä¸Š fromCache æ¨™è¨˜ï¼›è‹¥ç‚ºè² é¢å¿«å–ï¼ˆnullï¼‰ï¼Œç›´æ¥å› nullã€‚\n                return cached ? { ...cached, fromCache: true } : null;\n            }\n        }\n\n        // 2) æœªå‘½ä¸­å¿«å– â†’ å‘¼å«ä¾›æ‡‰å•†\n        const started = Date.now();\n        let result: GeoResult | null = null;\n\n        try {\n            const params: GeoLookupParams = { ip, timeoutMs, fetchImpl };\n            const providerResult = await this.provider.lookup(params);\n\n            // æ¨™æº–åŒ–çµæœï¼šç¢ºä¿ fromCache èˆ‡ elapsedMs ç”±æœå‹™å±¤è³¦å€¼\n            result = providerResult\n                ? { ...providerResult, fromCache: false, elapsedMs: Date.now() - started }\n                : null;\n\n            // 3) å¯«å…¥å¿«å–ï¼ˆä½¿ç”¨ç§’ä½œç‚ºå–®ä½ï¼›é™„å¸¶ tags ä¾¿æ–¼æ—¥å¾Œç¾¤çµ„æ¸…é™¤ï¼‰\n            await this.cache.set(\n                key,\n                result,\n                {\n                    ttl: msToSec(result ? GEO_SUCCESS_TTL_MS : GEO_NEGATIVE_TTL_MS), // æˆåŠŸé•·ã€å¤±æ•—çŸ­\n                    tags: ['geo', this.provider.name], // ä¾‹å¦‚å¯ delByTag('geo') åšæ‰¹æ¬¡æ¸…é™¤\n                }\n            );\n        } catch {\n            // 4) ä»»ä½•éŒ¯èª¤ï¼ˆå«é€¾æ™‚ï¼‰éƒ½é™ç´šç‚º nullï¼Œä¸¦åšçŸ­æœŸè² é¢å¿«å–ä»¥é˜²é›ªå´©\n            await this.cache.set(\n                key,\n                null,\n                {\n                    ttl: msToSec(GEO_NEGATIVE_TTL_MS),\n                    tags: ['geo', this.provider.name],\n                }\n            );\n            return null;\n        }\n\n        return result;\n    }\n\n    /**\n     * ä¾¿æ·æ–¹æ³•ï¼šåƒ…è¿”å›åœ‹å®¶ä»£ç¢¼ï¼ˆTW/US/JP...ï¼‰ï¼Œå¤±æ•—å› nullã€‚\n     */\n    async detectCountry(opts: DetectOptions = {}): Promise<string | null> {\n        const geo = await this.detectGeo(opts);\n        return geo?.countryCode ?? null;\n    }\n\n    /**\n     * å¤±æ•ˆç‰¹å®š IP çš„å¿«å–ï¼ˆç®¡ç†/é™¤éŒ¯ç”¨ï¼‰ã€‚\n     */\n    async invalidate(ip?: string): Promise<void> {\n        const key = `geo:${this.provider.name}:${toCoarseIpKey(ip)}`;\n        await this.cache.del(key);\n    }\n\n    /**\n     * æ¸…é™¤æ‰€æœ‰å¿«å–ï¼ˆè¬¹æ…ä½¿ç”¨ï¼›å¯å„ªå…ˆè€ƒæ…® delByTag('geo')ï¼‰ã€‚\n     */\n    async clearAll(): Promise<void> {\n        await this.cache.clear();\n    }\n}\n\n// å°å‡ºå–®ä¾‹ï¼Œä¾¿æ–¼ç›´æ¥ä½¿ç”¨ã€‚\nexport const geoService = new GeoService();\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1025, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/features/geo/strategy/geo-strategy.ts"],"sourcesContent":["/**\n * åœ°ç†ä½ç½®åµæ¸¬ç­–ç•¥ç®¡ç†æ¨¡çµ„\n *\n * æ­¤æ¨¡çµ„æä¾›çµ±ä¸€çš„åœ°ç†ä½ç½®åµæ¸¬ç­–ç•¥ä»‹é¢ï¼ŒæŠ½è±¡åŒ–ä¸åŒçš„åµæ¸¬æ–¹æ³•ï¼Œ\n * è®“ä¸Šå±¤æ‡‰ç”¨ç¨‹å¼å¯ä»¥é€éç­–ç•¥æ¨¡å¼é¸æ“‡æœ€é©åˆçš„åœ°ç†åµæ¸¬æ–¹å¼ã€‚\n *\n * æ”¯æ´çš„åµæ¸¬ç­–ç•¥ï¼š\n * 1. api-only: ç´”ç¬¬ä¸‰æ–¹ API åµæ¸¬ï¼ˆç›®å‰å¯¦ä½œ geopluginï¼‰\n * 2. cdn-only: åƒ…ä½¿ç”¨ CDN æ¨™é ­åµæ¸¬ï¼ˆé ç•™æ“´å……ï¼‰\n * 3. cdn-fallback: CDN å„ªå…ˆï¼Œå¤±æ•—æ™‚é™ç´šè‡³ APIï¼ˆé ç•™æ“´å……ï¼‰\n *\n * è¨­è¨ˆåŸå‰‡ï¼š\n * - ç­–ç•¥æ¨¡å¼ï¼šå°è£ä¸åŒåµæ¸¬æ–¹æ³•ï¼Œä¾¿æ–¼åˆ‡æ›å’Œæ“´å……\n * - çµ±ä¸€ä»‹é¢ï¼šæä¾›ä¸€è‡´çš„ APIï¼Œéš±è—åº•å±¤å¯¦ä½œç´°ç¯€\n * - æ¼¸é€²å¢å¼·ï¼šå„ªå…ˆä½¿ç”¨å¿«é€Ÿæ–¹æ³•ï¼Œå¤±æ•—æ™‚è‡ªå‹•é™ç´š\n * - å®¹éŒ¯è¨­è¨ˆï¼šåµæ¸¬å¤±æ•—ä¸é˜»å¡ä¸»æµç¨‹ï¼Œå›å‚³ null è®“ä¸Šå±¤è™•ç†\n *\n * ä½¿ç”¨å ´æ™¯ï¼š\n * - middleware: åœ¨è«‹æ±‚åˆæœŸå¿«é€Ÿåµæ¸¬ä½¿ç”¨è€…åœ°ç†ä½ç½®\n * - SSR: æ ¹æ“šåœ°ç†ä½ç½®æ±ºå®šé è¨­èªç³»å’Œå…§å®¹\n * - å€‹äººåŒ–: æä¾›åœ°å€ç›¸é—œçš„å…§å®¹å’Œæœå‹™\n *\n * æ•ˆèƒ½è€ƒé‡ï¼š\n * - API åµæ¸¬ï¼šæº–ç¢ºä½†è¼ƒæ…¢ï¼Œé©åˆé¦–æ¬¡è¨ªå•æˆ–ç²¾ç¢ºéœ€æ±‚\n * - CDN åµæ¸¬ï¼šå¿«é€Ÿä½†ç²¾åº¦è¼ƒä½ï¼Œé©åˆå³æ™‚æ±ºç­–\n * - æ··åˆç­–ç•¥ï¼šå¹³è¡¡é€Ÿåº¦èˆ‡æº–ç¢ºæ€§ï¼Œæä¾›æœ€ä½³ä½¿ç”¨è€…é«”é©—\n *\n * æ“´å……æ€§ï¼š\n * - æ–°å¢ç­–ç•¥åªéœ€å¯¦ä½œå°æ‡‰çš„ case åˆ†æ”¯\n * - åƒæ•¸çµæ§‹æ”¯æ´å„ç¨®åµæ¸¬éœ€æ±‚ï¼ˆIPã€è¶…æ™‚ã€å¿«å–ç­‰ï¼‰\n * - å¯æ³¨å…¥è‡ªè¨‚ fetch å¯¦ä½œï¼Œä¾¿æ–¼æ¸¬è©¦å’Œä»£ç†\n */\n\n// ä½œç”¨ï¼š\n// - åœ°ç†åµæ¸¬ç­–ç•¥çš„çµ±ä¸€å…¥å£ï¼ˆç›®å‰å…ˆæ”¯æ´ api-onlyï¼‰\n// - æŠ½è±¡æœªä¾†ç­–ç•¥ï¼šcdn-only / cdn-fallbackï¼Œè®“ä¸Šå±¤å‘¼å«ç«¯ä¸éœ€æ”¹å‹•\n// - å°è£ geoServiceï¼Œæä¾› detectCountry / detectGeo ä¾¿æ·æ–¹æ³•\n\nimport { geoService } from '@/features/geo/services/geo.service';\nimport type { GeoResult } from '@/features/geo/types/geo.types';\n\n/**\n * åœ°ç†åµæ¸¬ç­–ç•¥\n * - api-onlyï¼šåªå‘¼å«ç¬¬ä¸‰æ–¹ Geo APIï¼ˆç›®å‰ä½¿ç”¨ geopluginï¼‰\n * - cdn-onlyï¼šåƒ…è®€å– CDN æ¨™é ­ï¼ˆé ç•™ï¼‰\n * - cdn-fallbackï¼šå„ªå…ˆ CDNï¼Œå¤±æ•—æ”¹èµ° APIï¼ˆé ç•™ï¼‰\n */\nexport type GeoDetectionStrategy = 'api-only' | 'cdn-only' | 'cdn-fallback';\n\n/**\n * åµæ¸¬åƒæ•¸\n * - ipï¼šå¯é¸æŒ‡å®šæŸ¥è©¢ IPï¼›ä¸å¡«å‰‡ç”±ä¾›æ‡‰å•†ä¾ä¾†æº IP åˆ¤å®š\n * - timeoutMsï¼šç¬¬ä¸‰æ–¹ API é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰\n * - forceRefreshï¼šæ˜¯å¦å¿½ç•¥å¿«å–å¼·åˆ¶é‡æŸ¥\n * - fetchImplï¼šå¯æ³¨å…¥è‡ªå®š fetchï¼ˆæ¸¬è©¦/ä»£ç†ï¼‰\n */\nexport type GeoDetectParams = {\n    ip?: string;\n    timeoutMs?: number;\n    forceRefresh?: boolean;\n    fetchImpl?: typeof fetch;\n};\n\n/**\n * ä¾ç­–ç•¥åµæ¸¬å®Œæ•´åœ°ç†è³‡è¨Šï¼ˆç›®å‰å…ˆæ”¯æ´ api-onlyï¼‰\n * - å›å‚³æ¨™æº–åŒ–çµæœ GeoResult æˆ– null\n */\nexport async function detectGeoByStrategy(\n    params: GeoDetectParams = {},\n    strategy: GeoDetectionStrategy = 'api-only'\n): Promise<GeoResult | null> {\n    switch (strategy) {\n        case 'api-only':\n            return geoService.detectGeo(params);\n\n        // é ç•™ï¼šä¹‹å¾Œæ“´å…… CDN æ¨™é ­åµæ¸¬\n        // case 'cdn-only':\n        //   return detectViaCdnHeaders(...);\n\n        // é ç•™ï¼šä¹‹å¾Œæ“´å…… CDN å„ªå…ˆã€API å‚™æ´\n        // case 'cdn-fallback':\n        //   return (await detectViaCdnHeaders(...)) ?? geoService.detectGeo(params);\n\n        default:\n            // æœªçŸ¥ç­–ç•¥æ™‚ï¼Œä¿å®ˆé™ç´šï¼šä¸é˜»å¡æµç¨‹\n            return null;\n    }\n}\n\n/**\n * ä¾ç­–ç•¥åµæ¸¬åœ‹å®¶ä»£ç¢¼ï¼ˆTW/US/JP...ï¼‰ï¼ˆç›®å‰å…ˆæ”¯æ´ api-onlyï¼‰\n * - å›å‚³ ISO-3166-1 alpha-2 çš„é›™å­—æ¯ä»£ç¢¼æˆ– null\n */\nexport async function detectCountryByStrategy(\n    params: GeoDetectParams = {},\n    strategy: GeoDetectionStrategy = 'api-only'\n): Promise<string | null> {\n    switch (strategy) {\n        case 'api-only':\n            return geoService.detectCountry(params);\n\n        // é ç•™ï¼šä¹‹å¾Œæ“´å…… CDN æ¨™é ­åµæ¸¬\n        // case 'cdn-only':\n        //   return detectCountryViaCdnHeaders(...);\n\n        // é ç•™ï¼šä¹‹å¾Œæ“´å…… CDN å„ªå…ˆã€API å‚™æ´\n        // case 'cdn-fallback':\n        //   // å…ˆå˜—è©¦ CDNï¼Œå–ä¸åˆ°å†èµ° API\n        //   return (await detectCountryViaCdnHeaders(...)) ?? geoService.detectCountry(params);\n\n        default:\n            return null;\n    }\n}"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA+BC,GAED,MAAM;AACN,gCAAgC;AAChC,8CAA8C;AAC9C,oDAAoD;;;;;AAEpD;;AA6BO,eAAe,oBAClB,SAA0B,CAAC,CAAC,EAC5B,WAAiC,UAAU;IAE3C,OAAQ;QACJ,KAAK;YACD,OAAO,4JAAA,CAAA,aAAU,CAAC,SAAS,CAAC;QAEhC,mBAAmB;QACnB,mBAAmB;QACnB,qCAAqC;QAErC,wBAAwB;QACxB,uBAAuB;QACvB,6EAA6E;QAE7E;YACI,mBAAmB;YACnB,OAAO;IACf;AACJ;AAMO,eAAe,wBAClB,SAA0B,CAAC,CAAC,EAC5B,WAAiC,UAAU;IAE3C,OAAQ;QACJ,KAAK;YACD,OAAO,4JAAA,CAAA,aAAU,CAAC,aAAa,CAAC;QAEpC,mBAAmB;QACnB,mBAAmB;QACnB,4CAA4C;QAE5C,wBAAwB;QACxB,uBAAuB;QACvB,yBAAyB;QACzB,wFAAwF;QAExF;YACI,OAAO;IACf;AACJ"}},
    {"offset": {"line": 1100, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/features/geo/utils/ip.ts"],"sourcesContent":["// TypeScript\n// ä½œç”¨ï¼šæä¾›è·¨å±¤å¯é‡ç”¨çš„ IP è§£æå·¥å…·ï¼Œé¿å…ç›´æ¥è€¦åˆ Next çš„å‹åˆ¥\n\n/**\n * å¾ Headers ç‰©ä»¶èƒå–å®¢æˆ¶ç«¯ IP\n * æª¢æŸ¥é †åºï¼š\n * 1) X-Forwarded-For çš„ç¬¬ä¸€å€‹ IPï¼ˆä»£ç†/è² è¼‰å‡è¡¡å™¨å¸¸è¦‹ï¼‰\n * 2) X-Real-IPï¼ˆæŸäº›ä»£ç†ä¼ºæœå™¨ä½¿ç”¨ï¼‰\n */\nexport function extractClientIpFromHeaders(\n    headers: Headers | Record<string, string | string[] | undefined>\n): string | undefined {\n    // è®€å– headerï¼ˆç›¸å®¹ Headers èˆ‡ä¸€èˆ¬ç‰©ä»¶ï¼‰\n    const getHeader = (name: string): string | undefined => {\n        if (typeof (headers as any)?.get === 'function') {\n            const v = (headers as Headers).get(name);\n            return v ?? undefined;\n        }\n        const raw = (headers as Record<string, any>)[name.toLowerCase()] ?? (headers as Record<string, any>)[name];\n        if (Array.isArray(raw)) return raw[0];\n        return raw;\n    };\n\n    // 1) x-forwarded-for: å¯èƒ½æ˜¯ \"client, proxy1, proxy2\"ï¼Œå–ç¬¬ä¸€å€‹\n    const xff = getHeader('x-forwarded-for');\n    if (xff) {\n        const first = xff.split(',')[0]?.trim();\n        const ip = normalizeIp(first);\n        if (ip) return ip;\n    }\n\n    // 2) x-real-ip\n    const xri = getHeader('x-real-ip');\n    if (xri) {\n        const ip = normalizeIp(xri.trim());\n        if (ip) return ip;\n    }\n\n    return undefined;\n}\n\n/**\n * å¾ NextRequest æ¨å°å®¢æˆ¶ç«¯ IPï¼ˆä¸ç›´æ¥ä¾è³´ Next å‹åˆ¥ï¼‰\n * - å…ˆç”¨ headers èƒå–\n * - å¤±æ•—å†å˜—è©¦ req.ipï¼ˆè‹¥å­˜åœ¨ï¼‰\n */\nexport function getClientIpFromRequest(req: { headers: any; ip?: string }): string | undefined {\n    const fromHeaders = extractClientIpFromHeaders(req.headers);\n    if (fromHeaders) return fromHeaders;\n\n    const possible = req.ip;\n    return normalizeIp(possible);\n}\n\n/**\n * æª¢æŸ¥æ˜¯å¦ç‚ºå…§ç¶²/ä¿ç•™ä½å€ï¼ˆå¯ç”¨æ–¼éæ¿¾ï¼‰\n */\nexport function isPrivateOrReservedIp(ip?: string): boolean {\n    if (!ip) return true;\n    const v4 = ip.includes('.');\n    if (v4) {\n        if (ip.startsWith('10.')) return true;\n        const parts = ip.split('.');\n        const a = Number(parts[0]), b = Number(parts[1]);\n        if (a === 172 && b >= 16 && b <= 31) return true;\n        if (ip.startsWith('192.168.')) return true;\n        if (ip === '127.0.0.1') return true;\n    } else {\n        // IPv6 å¸¸è¦‹æœ¬æ©Ÿ/ä¿ç•™\n        if (ip === '::1') return true;\n        if (ip.toLowerCase().startsWith('fc') || ip.toLowerCase().startsWith('fd')) return true; // Unique local\n    }\n    return false;\n}\n\n/**\n * å°‡è¼¸å…¥æ­£è¦åŒ–ç‚ºéç©ºçš„ IP å­—ä¸²ï¼ˆè‹¥ä¸åˆæ³•å‰‡å›å‚³ undefinedï¼‰\n */\nfunction normalizeIp(val: unknown): string | undefined {\n    if (typeof val !== 'string') return undefined;\n    const s = val.trim();\n    if (!s) return undefined;\n    // åŸºç¤æª¢æ ¸ï¼ˆä¸åšåš´æ ¼é©—è­‰ï¼Œä¿ç•™å½ˆæ€§ï¼‰\n    if (!(s.includes('.') || s.includes(':'))) return undefined;\n    return s;\n}"],"names":[],"mappings":"AAAA,aAAa;AACb,sCAAsC;AAEtC;;;;;CAKC;;;;;AACM,SAAS,2BACZ,OAAgE;IAEhE,8BAA8B;IAC9B,MAAM,YAAY,CAAC;QACf,IAAI,OAAQ,SAAiB,QAAQ,YAAY;YAC7C,MAAM,IAAI,AAAC,QAAoB,GAAG,CAAC;YACnC,OAAO,KAAK;QAChB;QACA,MAAM,MAAM,AAAC,OAA+B,CAAC,KAAK,WAAW,GAAG,IAAI,AAAC,OAA+B,CAAC,KAAK;QAC1G,IAAI,MAAM,OAAO,CAAC,MAAM,OAAO,GAAG,CAAC,EAAE;QACrC,OAAO;IACX;IAEA,wDAAwD;IACxD,MAAM,MAAM,UAAU;IACtB,IAAI,KAAK;QACL,MAAM,QAAQ,IAAI,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE;QACjC,MAAM,KAAK,YAAY;QACvB,IAAI,IAAI,OAAO;IACnB;IAEA,eAAe;IACf,MAAM,MAAM,UAAU;IACtB,IAAI,KAAK;QACL,MAAM,KAAK,YAAY,IAAI,IAAI;QAC/B,IAAI,IAAI,OAAO;IACnB;IAEA,OAAO;AACX;AAOO,SAAS,uBAAuB,GAAkC;IACrE,MAAM,cAAc,2BAA2B,IAAI,OAAO;IAC1D,IAAI,aAAa,OAAO;IAExB,MAAM,WAAW,IAAI,EAAE;IACvB,OAAO,YAAY;AACvB;AAKO,SAAS,sBAAsB,EAAW;IAC7C,IAAI,CAAC,IAAI,OAAO;IAChB,MAAM,KAAK,GAAG,QAAQ,CAAC;IACvB,IAAI,IAAI;QACJ,IAAI,GAAG,UAAU,CAAC,QAAQ,OAAO;QACjC,MAAM,QAAQ,GAAG,KAAK,CAAC;QACvB,MAAM,IAAI,OAAO,KAAK,CAAC,EAAE,GAAG,IAAI,OAAO,KAAK,CAAC,EAAE;QAC/C,IAAI,MAAM,OAAO,KAAK,MAAM,KAAK,IAAI,OAAO;QAC5C,IAAI,GAAG,UAAU,CAAC,aAAa,OAAO;QACtC,IAAI,OAAO,aAAa,OAAO;IACnC,OAAO;QACH,eAAe;QACf,IAAI,OAAO,OAAO,OAAO;QACzB,IAAI,GAAG,WAAW,GAAG,UAAU,CAAC,SAAS,GAAG,WAAW,GAAG,UAAU,CAAC,OAAO,OAAO,MAAM,eAAe;IAC5G;IACA,OAAO;AACX;AAEA;;CAEC,GACD,SAAS,YAAY,GAAY;IAC7B,IAAI,OAAO,QAAQ,UAAU,OAAO;IACpC,MAAM,IAAI,IAAI,IAAI;IAClB,IAAI,CAAC,GAAG,OAAO;IACf,oBAAoB;IACpB,IAAI,CAAC,CAAC,EAAE,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,IAAI,GAAG,OAAO;IAClD,OAAO;AACX"}},
    {"offset": {"line": 1175, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["/**\n * Next.js Middleware - åœ‹éš›åŒ–èˆ‡åœ°ç†ä½ç½®åµæ¸¬\n *\n * æ­¤ middleware æ•´åˆäº† next-intl çš„åœ‹éš›åŒ–åŠŸèƒ½èˆ‡è‡ªè¨‚çš„åœ°ç†ä½ç½®åµæ¸¬ï¼Œ\n * åœ¨æ¯å€‹è«‹æ±‚çš„æ—©æœŸéšæ®µåŸ·è¡Œä»¥ä¸‹è™•ç†ï¼š\n *\n * 1. åœ‹éš›åŒ–è™•ç†ï¼šé€é next-intl è™•ç†èªç³»è·¯ç”±ã€é‡å°å‘ç­‰\n * 2. åœ°ç†åµæ¸¬ï¼šæ ¹æ“šç’°å¢ƒè®Šæ•¸æ±ºå®šæ˜¯å¦åŸ·è¡Œï¼Œé¿å…ä¸å¿…è¦çš„è™•ç†\n * 3. å®¹éŒ¯è¨­è¨ˆï¼šåœ°ç†åµæ¸¬å¤±æ•—ä¸å½±éŸ¿ä¸»è¦çš„åœ‹éš›åŒ–æµç¨‹\n *\n * åŸ·è¡Œé †åºï¼š\n * - å…ˆåŸ·è¡Œ next-intl middleware å–å¾—åŸºç¤å›æ‡‰\n * - æª¢æŸ¥åœ°ç†åµæ¸¬é–‹é—œï¼Œæ±ºå®šæ˜¯å¦åŸ·è¡Œåµæ¸¬é‚è¼¯\n * - åœ¨åŒä¸€å›æ‡‰ä¸Šè¿½åŠ åœ°ç†åµæ¸¬çµæœçš„ Cookie\n * - ç¢ºä¿åŸæœ‰çš„é‡å°å‘ã€é‡å¯«ç­‰è¡Œç‚ºä¸å—å½±éŸ¿\n *\n * åœ°ç†åµæ¸¬ç‰¹æ€§ï¼š\n * - å— GEO_DETECTION_ENABLED ç’°å¢ƒè®Šæ•¸æ§åˆ¶\n * - ä½¿ç”¨ api-only ç­–ç•¥ï¼ˆé€éç¬¬ä¸‰æ–¹ APIï¼‰\n * - 800ms è¶…æ™‚é™åˆ¶ï¼Œé¿å…é˜»å¡è«‹æ±‚\n * - åµæ¸¬çµæœå­˜å…¥ detected_country Cookieï¼ˆ1å¤©æœ‰æ•ˆæœŸï¼‰\n * - åµæ¸¬å¤±æ•—æ™‚æ¸…é™¤èˆŠçš„ Cookie é¿å…éæœŸè³‡æ–™\n */\n\nimport type {NextRequest} from 'next/server';\nimport {NextResponse} from 'next/server';\nimport createMiddleware from 'next-intl/middleware';\nimport {routing} from '@/i18n/routing';\nimport {detectCountryByStrategy} from '@/features/geo/strategy/geo-strategy'; // åœ°ç†ä½ç½®çš„ç­–ç•¥å‡½æ•¸\nimport {getClientIpFromRequest} from '@/features/geo/utils/ip'; // å–å¾— IP ä½ç½®çš„å‡½æ•¸\nimport {env} from '@/env.mjs';\n\n\n// å…ˆå»ºç«‹ next-intl çš„æ—¢æœ‰ middleware\nconst intlMiddleware = createMiddleware(routing);\n\n// åœ¨æ¨¡çµ„å±¤å®šç¾©ï¼šå°‡ NODE_ENV æ­£è¦åŒ–æˆä¸€èˆ¬å­—ä¸²å†æ¯”è¼ƒï¼Œé¿å…å­—é¢é‡å‹åˆ¥å¼•ç™¼ TS2367\nconst isDevEnv = (() => {\n    const v = String(process.env.NODE_ENV || '').toLowerCase();\n    return v === 'development';\n})();\n\n\nexport default async function middleware(req: NextRequest) {\n    // 1) å…ˆåŸ·è¡Œ next-intl çš„ middlewareï¼Œä¿ç•™å…¶ redirect/rewrite ç­‰è¡Œç‚º\n    const res = intlMiddleware(req) as NextResponse;\n\n\n    // 2) ä¾ç’°å¢ƒé–‹é—œæ±ºå®šæ˜¯å¦åŸ·è¡Œåœ°ç†åµæ¸¬\n    if (!env.INTERNATIONALIZATION_ENABLED || !env.GEO_DETECTION_ENABLED) {\n        return res;\n    }\n\n    // 3) åœ¨åŒä¸€å€‹å›æ‡‰ä¸Šè¿½åŠ  geo åµæ¸¬ï¼ˆapi-onlyï¼‰èˆ‡ Cookie å¯«å…¥\n    try {\n        const ip = getClientIpFromRequest(req);\n        const timeoutMs = env.GEO_API_TIMEOUT; // ä¾†è‡ªç’°å¢ƒçš„é€¾æ™‚ï¼ˆæ¯«ç§’ï¼‰\n        const country = await detectCountryByStrategy({ip, timeoutMs}, 'api-only');\n        // åƒ…åœ¨é–‹ç™¼æ¨¡å¼å¯«å…¥ debug ç”¨çš„ detected_ip Cookie\n        if (process.env.NODE_ENV === 'development') {\n            const detectedIp = ip ?? '';\n            res.cookies.set('detected_ip', detectedIp, {\n                maxAge: 60 * 60 * 24, // 1 å¤©ï¼ˆç§’ï¼‰\n                path: '/',\n                sameSite: 'lax',\n                secure: !isDevEnv,\n                httpOnly: false\n            });\n        }\n\n        if (country) {\n            res.cookies.set('detected_country', country, {\n                maxAge: 60 * 60 * 24, // 1 å¤©ï¼ˆç§’ï¼‰\n                path: '/',\n                sameSite: 'lax',\n                secure: process.env.NODE_ENV === 'production',\n                httpOnly: false\n            });\n        } else {\n            res.cookies.set('detected_country', '', {\n                maxAge: 0,\n                path: '/',\n                sameSite: 'lax'\n            });\n        }\n    } catch {\n        // éœé»˜å¤±æ•—ï¼Œä¸å½±éŸ¿ i18n çš„æµç¨‹\n    }\n\n    return res;\n}\n\n\n\n\n/**\n * Middleware é…ç½®\n *\n * åŒ¹é…æ‰€æœ‰è·¯å¾‘ï¼Œé™¤äº†ä»¥ä¸‹æƒ…æ³ï¼š\n * - ä»¥ `/api`ã€`/trpc`ã€`/_next` æˆ– `/_vercel` é–‹é ­çš„è·¯å¾‘\n * - åŒ…å«é»è™Ÿçš„è·¯å¾‘ï¼ˆä¾‹å¦‚ `favicon.ico`ã€éœæ…‹æª”æ¡ˆï¼‰\n *\n * é€™æ¨£çš„é…ç½®ç¢ºä¿ï¼š\n * - API è·¯ç”±ä¸å—åœ‹éš›åŒ–å½±éŸ¿\n * - Next.js å…§éƒ¨è·¯å¾‘ä¸è¢«è™•ç†\n * - éœæ…‹è³‡æºç›´æ¥æä¾›ï¼Œä¸ç¶“é middleware\n */\nexport const config = {\n    matcher: '/((?!api|trpc|_next|_vercel|.*\\\\..*).*)'\n};"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;CAsBC;;;;AAID;AACA;AACA,mRAA8E,YAAY;AAC1F,sPAAgE,cAAc;AAC9E;;;;;;AAGA,+BAA+B;AAC/B,MAAM,iBAAiB,CAAA,GAAA,8LAAA,CAAA,UAAgB,AAAD,EAAE,8HAAA,CAAA,UAAO;AAE/C,iDAAiD;AACjD,MAAM,WAAW,CAAC;IACd,MAAM,IAAI,OAAO,mDAAwB,IAAI,WAAW;IACxD,OAAO,MAAM;AACjB,CAAC;AAGc,eAAe,WAAW,GAAgB;IACrD,yDAAyD;IACzD,MAAM,MAAM,eAAe;IAG3B,qBAAqB;IACrB,IAAI,CAAC,mHAAA,CAAA,MAAG,CAAC,4BAA4B,IAAI,CAAC,mHAAA,CAAA,MAAG,CAAC,qBAAqB,EAAE;QACjE,OAAO;IACX;IAEA,2CAA2C;IAC3C,IAAI;QACA,MAAM,KAAK,CAAA,GAAA,6IAAA,CAAA,yBAAsB,AAAD,EAAE;QAClC,MAAM,YAAY,mHAAA,CAAA,MAAG,CAAC,eAAe,EAAE,cAAc;QACrD,MAAM,UAAU,MAAM,CAAA,GAAA,6JAAA,CAAA,0BAAuB,AAAD,EAAE;YAAC;YAAI;QAAS,GAAG;QAC/D,uCAAuC;QACvC,wCAA4C;YACxC,MAAM,aAAa,MAAM;YACzB,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe,YAAY;gBACvC,QAAQ,KAAK,KAAK;gBAClB,MAAM;gBACN,UAAU;gBACV,QAAQ,CAAC;gBACT,UAAU;YACd;QACJ;QAEA,IAAI,SAAS;YACT,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,SAAS;gBACzC,QAAQ,KAAK,KAAK;gBAClB,MAAM;gBACN,UAAU;gBACV,QAAQ,oDAAyB;gBACjC,UAAU;YACd;QACJ,OAAO;YACH,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,IAAI;gBACpC,QAAQ;gBACR,MAAM;gBACN,UAAU;YACd;QACJ;IACJ,EAAE,OAAM;IACJ,oBAAoB;IACxB;IAEA,OAAO;AACX;AAiBO,MAAM,SAAS;IAClB,SAAS;AACb"}}]
}